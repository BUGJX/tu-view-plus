"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),U=require("./picker.js"),h=require("@tu-view-plus/hooks"),Ne=require("./hooks/use-format.js"),Oe=require("./hooks/use-picker-state.js"),ze=require("./hooks/use-is-disabled-date.js"),Ee=require("./hooks/use-value-format.js"),Le=require("./hooks/use-header-value.js"),xe=require("./hooks/use-time-picker-value.js"),u=require("@tu-view-plus/utils");require("../../form/index.js");const w=require("../../time-picker/src/utils.js"),Re=require("./utils.js"),_e=require("../../trigger/index.js"),A=require("./picker-dropdown.vue.js"),We=require("../../picker/index.js"),je=require("../../icon/index.js"),Ue=require("@tu-view-plus/icons-vue");require("../style/index.css");const G=require("../../form/src/hooks/use-form-props.js"),Ae=t.defineComponent({name:"Picker"}),Ge=t.defineComponent({...Ae,props:U.pickerProps,emits:U.pickerEmits,setup(J,{emit:K}){let b;const D=J,r=K,d=t.useSlots(),{mode:n,modelValue:Q,defaultValue:X,format:p,valueFormat:Y,placeholder:y,popupVisible:Z,defaultPopupVisible:ee,disabled:Je,showTime:C,timePickerProps:i,disabledDate:te,disabledTime:ae,readonly:F,locale:Ke,pickerValue:oe,defaultPickerValue:ue,dayStartOfWeek:Qe,previewShortcut:O,showConfirmBtn:re}=t.toRefs(D);h.useNamespace("picker");const{t:v}=h.useLocale();G.useFormSize();const B=G.useFormDisabled(),l=t.ref(),[s,le]=h.useMergeState(ee.value,t.reactive({value:Z})),[ne,k]=h.useState(),z=t.computed(()=>p&&u.isFunction(p.value)?e=>{var a;return(a=p.value)==null?void 0:a.call(p,u.getDateValue(e))}:S.value),ie=t.computed(()=>!F.value&&!u.isFunction(z.value)),{format:S,valueFormat:se,parseValueFormat:m}=Ne.useFormat(t.reactive({format:p,mode:n,showTime:C,valueFormat:Y})),ce=t.computed(()=>(y==null?void 0:y.value)||{date:v("tu.datepicker.placeholder.date"),month:v("tu.datepicker.placeholder.month"),year:v("tu.datepicker.placeholder.year"),week:v("tu.datepicker.placeholder.week"),quarter:v("tu.datepicker.placeholder.quarter")}[n.value]||v("tu.datepicker.placeholder.date")),E=t.computed(()=>L.value??T.value),de=t.computed(()=>g.value&&(!E.value||$(E.value))),pe=t.computed(()=>({format:S.value,...u.omit((i==null?void 0:i.value)||{},["defaultValue"]),visible:s.value})),g=t.computed(()=>C.value||re.value),{value:T,setValue:ve}=Oe.usePickerState(t.reactive({modelValue:Q,defaultValue:X,format:m})),I=Ee.useReturnValue(t.reactive({format:se})),[L,M]=h.useState(),[me,P]=h.useState(),c=t.computed(()=>me.value??L.value??T.value),$=ze.useIsDisabledDate(t.reactive({mode:n,disabledDate:te,disabledTime:ae,showTime:C})),{headerValue:x,setHeaderValue:fe,headerOperations:Ve,resetHeaderValue:he}=Le.useHeaderValue(t.reactive({mode:n,value:oe,defaultValue:ue,selectedValue:c,format:m,onChange:e=>{const a=I(e),o=w.getFormattedValue(e,m.value),V=u.getDateValue(e);r("picker-value-change",a,V,o),r("update:pickerValue",a)}})),[R,,ke]=xe.useTimePickerValue(t.reactive({timePickerProps:i,selectedValue:c})),ge=t.computed(()=>n.value==="date"&&C.value),H=e=>{s.value!==e&&(le(e),r("popup-visible-change",e),r("update:popupVisible",e))},Pe=(e,a)=>{const o=e?I(e):void 0,V=w.getFormattedValue(e,m.value),q=u.getDateValue(e);u.isValueChange(e,T.value)&&(r("update:modelValue",o),r("change",o,q,V)),a&&r("ok",o,q,V)},_=(e,a)=>{if(M(e),P(void 0),k(void 0),l.value=void 0,a){const o=e?I(e):void 0,V=w.getFormattedValue(e,m.value),q=u.getDateValue(e);r("select",o,q,V)}},f=(e,a,o)=>{$(e)||(Pe(e,o),ve(e),M(void 0),P(void 0),k(void 0),l.value=void 0,u.isBoolean(a)&&H(a))},be=e=>{B.value||H(e)},Ce=e=>{e.stopPropagation(),f(void 0),r("clear")},Se=e=>{H(!0);const a=e.target.value;if(k(a),!w.isValidInputValue(a,S.value))return;const o=u.dayjs(a,S.value);$(o)||(g.value?_(o):f(o,!0))},Te=()=>{f(c.value,!1)},qe=()=>{},W=(e,a)=>!ge.value&&!(i!=null&&i.value)?e:Re.mergeValueWithTime(u.getNow(),e,a),N=e=>{g.value?_(e,!0):f(e,!1)},we=e=>{const a=W(e,R.value);N(a)},De=e=>{const a=W(c.value||u.getNow(),e);N(a)},ye=()=>{f(c.value,!1,!0)},Fe=(e,a)=>{r("select-shortcut",a),f(e,!1)},Be=e=>{clearTimeout(b),P(e),k(void 0)},Ie=()=>{clearTimeout(b),b=setTimeout(()=>{P(void 0)},100)},Me=e=>{l.value=e},$e=e=>{let a=x.value;if(a=a.set("year",e.year()),l.value==="month"&&(a=a.set("month",e.month())),fe(a),n.value==="quarter"||n.value==="month"){l.value=void 0;return}l.value=l.value==="year"?"month":void 0},He=()=>{l.value="year"},j=t.computed(()=>({...u.pick(D,["mode","shortcuts","shortcutsPosition","dayStartOfWeek","disabledDate","disabledTime","showTime","hideTrigger","abbreviation"]),showNowBtn:D.showNowBtn&&n.value==="date",format:m.value,value:c.value,visible:s.value,showConfirmBtn:g.value,confirmBtnDisabled:de.value,timePickerProps:pe.value,extra:d.extra,dateRender:d.cell,headerValue:x.value,headerIcons:{prev:d["icon-prev"],prevDouble:d["icon-prev-double"],next:d["icon-next"],nextDouble:d["icon-next-double"]},headerOperations:Ve.value,timePickerValue:R.value,headerMode:l.value,onCellClick:we,onTimePickerSelect:De,onConfirm:ye,onShortcutClick:Fe,onShortcutMouseEnter:O.value?Be:void 0,onShortcutMouseLeave:O.value?Ie:void 0,onTodayBtnClick:N,onHeaderLabelClick:Me,onHeaderSelect:$e,onMonthHeaderClick:He}));return t.watch(s,e=>{M(void 0),P(void 0),l.value=void 0,e&&(he(),ke()),e||k(void 0)}),t.onUnmounted(()=>{clearTimeout(b)}),(e,a)=>e.hideTrigger?(t.openBlock(),t.createBlock(A.default,t.normalizeProps(t.mergeProps({key:1},{...e.$attrs,...j.value})),null,16)):(t.openBlock(),t.createBlock(t.unref(_e.TuTrigger),t.mergeProps({key:0,trigger:"click","animation-name":"slide-dynamic-origin","auto-fit-transform-origin":"","click-to-close":!1,"popup-offset":10},e.triggerProps,{position:e.position,disabled:t.unref(B)||t.unref(F),"prevent-focus":!0,"popup-visible":t.unref(s),"unmount-on-close":e.unmountOnClose,"popup-container":e.popupContainer,onPopupVisibleChange:be}),{content:t.withCtx(()=>[t.createVNode(A.default,t.normalizeProps(t.guardReactiveProps(j.value)),null,16)]),default:t.withCtx(()=>[t.renderSlot(e.$slots,"default",{},()=>[t.createVNode(t.unref(We.TuPicker),t.mergeProps({ref:"refInput"},e.$attrs,{size:e.size,focused:t.unref(s),visible:t.unref(s),error:e.error,disabled:t.unref(B),readonly:!ie.value||e.disabledInput,"allow-clear":e.allowClear&&!t.unref(F),placeholder:ce.value,"input-value":t.unref(ne),value:g.value?c.value:t.unref(T),format:z.value,onClear:Ce,onChange:Se,onPressEnter:Te,onBlur:qe}),t.createSlots({"suffix-icon":t.withCtx(()=>[t.renderSlot(e.$slots,"suffix-icon",{},()=>[t.createVNode(t.unref(je.TuIcon),null,{default:t.withCtx(()=>[t.createVNode(t.unref(Ue.Calendar))]),_:1})])]),_:2},[e.$slots.prefix?{name:"prefix",fn:t.withCtx(()=>[t.renderSlot(e.$slots,"prefix")]),key:"0"}:void 0]),1040,["size","focused","visible","error","disabled","readonly","allow-clear","placeholder","input-value","value","format"])])]),_:3},16,["position","disabled","popup-visible","unmount-on-close","popup-container"]))}});exports.default=Ge;
