"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),U=require("./picker.js"),P=require("@tu-view-plus/hooks"),Le=require("./hooks/use-format.js"),Oe=require("./hooks/use-picker-state.js"),_e=require("./hooks/use-is-disabled-date.js"),xe=require("./hooks/use-value-format.js"),Re=require("./hooks/use-header-value.js"),je=require("./hooks/use-time-picker-value.js"),u=require("@tu-view-plus/utils"),We=require("./utils.js");require("../../form/index.js");const y=require("../../time-picker/src/utils.js"),Ae=require("../../trigger/index.js"),G=require("./picker-dropdown.vue.js"),Ue=require("../../picker/index.js"),Ge=require("../../icon/index.js"),Je=require("@tu-view-plus/icons-vue");require("../style/index.css");const J=require("../../form/src/hooks/use-form-props.js"),Ke=t.defineComponent({name:"Picker",inheritAttrs:!1}),Qe=t.defineComponent({...Ke,props:U.pickerProps,emits:U.pickerEmits,setup(K,{emit:Q}){let b;const C=K,r=Q,d=t.useSlots(),{mode:n,modelValue:X,defaultValue:Y,format:p,valueFormat:Z,placeholder:F,popupVisible:ee,defaultPopupVisible:te,showTime:S,timePickerProps:i,disabledDate:oe,disabledTime:ae,readonly:I,pickerValue:ue,defaultPickerValue:re,previewShortcut:E,showConfirmBtn:le}=t.toRefs(C),{t:v}=P.useLocale();J.useFormSize();const B=J.useFormDisabled(),T=t.ref(),l=t.ref(),[s,ne]=P.useMergeState(te.value,t.reactive({value:ee})),[ie,h]=P.useState(),L=t.computed(()=>p&&u.isFunction(p.value)?e=>{var o;return(o=p.value)==null?void 0:o.call(p,u.getDateValue(e))}:q.value),se=t.computed(()=>!I.value&&!u.isFunction(L.value)),{format:q,valueFormat:ce,parseValueFormat:m}=Le.useFormat(t.reactive({format:p,mode:n,showTime:S,valueFormat:Z})),de=t.computed(()=>(F==null?void 0:F.value)||{date:v("tu.datepicker.placeholder.date"),month:v("tu.datepicker.placeholder.month"),year:v("tu.datepicker.placeholder.year"),week:v("tu.datepicker.placeholder.week"),quarter:v("tu.datepicker.placeholder.quarter")}[n.value]||v("tu.datepicker.placeholder.date")),O=t.computed(()=>_.value??w.value),pe=t.computed(()=>k.value&&(!O.value||H(O.value))),ve=t.computed(()=>({format:q.value,...u.omit((i==null?void 0:i.value)||{},["defaultValue"]),visible:s.value})),k=t.computed(()=>S.value||le.value),{value:w,setValue:me}=Oe.usePickerState(t.reactive({modelValue:X,defaultValue:Y,format:m})),M=xe.useReturnValue(t.reactive({format:ce})),[_,$]=P.useState(),[fe,g]=P.useState(),c=t.computed(()=>fe.value??_.value??w.value),H=_e.useIsDisabledDate(t.reactive({mode:n,disabledDate:oe,disabledTime:ae,showTime:S})),{headerValue:x,setHeaderValue:Ve,headerOperations:he,resetHeaderValue:ke}=Re.useHeaderValue(t.reactive({mode:n,value:ue,defaultValue:re,selectedValue:c,format:m,onChange:e=>{const o=M(e),a=y.getFormattedValue(e,m.value),V=u.getDateValue(e);r("picker-value-change",o,V,a),r("update:pickerValue",o)}})),[R,,ge]=je.useTimePickerValue(t.reactive({timePickerProps:i,selectedValue:c})),Pe=t.computed(()=>n.value==="date"&&S.value),N=e=>{s.value!==e&&(ne(e),r("popup-visible-change",e),r("update:popupVisible",e))},be=(e,o)=>{const a=e?M(e):void 0,V=y.getFormattedValue(e,m.value),D=u.getDateValue(e);u.isValueChange(e,w.value)&&(r("update:modelValue",a),r("change",a,D,V)),o&&r("ok",a,D,V)},j=(e,o)=>{if($(e),g(void 0),h(void 0),l.value=void 0,o){const a=e?M(e):void 0,V=y.getFormattedValue(e,m.value),D=u.getDateValue(e);r("select",a,D,V)}},f=(e,o,a)=>{H(e)||(be(e,a),me(e),$(void 0),g(void 0),h(void 0),l.value=void 0,u.isBoolean(o)&&N(o))},Ce=e=>{B.value||N(e)},Se=e=>{e.stopPropagation(),f(void 0),r("clear")},Te=e=>{N(!0);const o=e.target.value;if(h(o),!y.isValidInputValue(o,q.value))return;const a=u.dayjs(o,q.value);H(a)||(k.value?j(a):f(a,!0))},qe=()=>{f(c.value,!1)},we=()=>{},W=(e,o)=>!Pe.value&&!(i!=null&&i.value)?e:We.mergeValueWithTime(u.getNow(),e,o),z=e=>{k.value?j(e,!0):f(e,!1)},De=e=>{const o=W(e,R.value);z(o)},ye=e=>{const o=W(c.value||u.getNow(),e);z(o)},Fe=()=>{f(c.value,!1,!0)},Ie=(e,o)=>{r("select-shortcut",o),f(e,!1)},Be=e=>{clearTimeout(b),g(e),h(void 0)},Me=()=>{clearTimeout(b),b=setTimeout(()=>{g(void 0)},100)},$e=e=>{l.value=e},He=e=>{let o=x.value;if(o=o.set("year",e.year()),l.value==="month"&&(o=o.set("month",e.month())),Ve(o),n.value==="quarter"||n.value==="month"){l.value=void 0;return}l.value=l.value==="year"?"month":void 0},Ne=()=>{l.value="year"},ze=e=>{T.value&&T.value.focus&&T.value.focus(e)},Ee=()=>{C.disabledInput&&ze()},A=t.computed(()=>({...u.pick(C,["mode","shortcuts","shortcutsPosition","dayStartOfWeek","disabledDate","disabledTime","showTime","hideTrigger","abbreviation","size"]),showNowBtn:C.showNowBtn&&n.value==="date",format:m.value,value:c.value,visible:s.value,showConfirmBtn:k.value,confirmBtnDisabled:pe.value,timePickerProps:ve.value,extra:d.extra,dateRender:d.cell,headerValue:x.value,headerIcons:{prev:d["icon-prev"],prevDouble:d["icon-prev-double"],next:d["icon-next"],nextDouble:d["icon-next-double"]},headerOperations:he.value,timePickerValue:R.value,headerMode:l.value,onCellClick:De,onTimePickerSelect:ye,onConfirm:Fe,onShortcutClick:Ie,onShortcutMouseEnter:E.value?Be:void 0,onShortcutMouseLeave:E.value?Me:void 0,onTodayBtnClick:z,onHeaderLabelClick:$e,onHeaderSelect:He,onMonthHeaderClick:Ne}));return t.watch(s,e=>{$(void 0),g(void 0),l.value=void 0,e&&(ke(),ge()),e||h(void 0)}),t.onUnmounted(()=>{clearTimeout(b)}),(e,o)=>e.hideTrigger?(t.openBlock(),t.createBlock(G.default,t.normalizeProps(t.mergeProps({key:1},{...e.$attrs,...A.value})),null,16)):(t.openBlock(),t.createBlock(t.unref(Ae.TuTrigger),t.mergeProps({key:0},e.triggerProps,{trigger:"click","animation-name":"slide-dynamic-origin","auto-fit-transform-origin":"","click-to-close":!1,"popup-offset":10,position:e.position,disabled:t.unref(B)||t.unref(I),"prevent-focus":!0,"popup-visible":t.unref(s),"unmount-on-close":e.unmountOnClose,"popup-container":e.popupContainer,onPopupVisibleChange:Ce}),{content:t.withCtx(()=>[t.createVNode(G.default,t.mergeProps(A.value,{onClick:Ee}),null,16)]),default:t.withCtx(()=>[t.renderSlot(e.$slots,"default",{},()=>[t.createVNode(t.unref(Ue.TuPicker),t.mergeProps({ref_key:"refInput",ref:T},e.$attrs,{size:e.size,focused:t.unref(s),visible:t.unref(s),error:e.error,disabled:t.unref(B),readonly:!se.value||e.disabledInput,"allow-clear":e.allowClear&&!t.unref(I),placeholder:de.value,"input-value":t.unref(ie),value:k.value?c.value:t.unref(w),format:L.value,onClear:Se,onChange:Te,onPressEnter:qe,onBlur:we}),t.createSlots({"suffix-icon":t.withCtx(()=>[t.renderSlot(e.$slots,"suffix-icon",{},()=>[t.createVNode(t.unref(Ge.TuIcon),null,{default:t.withCtx(()=>[t.createVNode(t.unref(Je.Calendar))]),_:1})])]),_:2},[e.$slots.prefix?{name:"prefix",fn:t.withCtx(()=>[t.renderSlot(e.$slots,"prefix")]),key:"0"}:void 0]),1040,["size","focused","visible","error","disabled","readonly","allow-clear","placeholder","input-value","value","format"])])]),_:3},16,["position","disabled","popup-visible","unmount-on-close","popup-container"]))}});exports.default=Qe;
