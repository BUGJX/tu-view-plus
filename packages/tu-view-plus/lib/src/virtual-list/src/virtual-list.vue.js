"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),k=require("./virtual-list.js"),s=require("@tu-view-plus/utils"),I=require("@tu-view-plus/hooks"),M=require("./use-virtual-list-size.js"),j=require("./virtual-list-item.vue.js");require("../style/virtual-list.css");const A=e.defineComponent({name:"TuVirtualList"}),E=e.defineComponent({...A,props:k.virtualListProps,emits:k.virtualListEmits,setup(B,{expose:T,emit:d}){const n=B,{data:i,itemKey:f,fixedSize:z,estimatedSize:C,buffer:m,height:L}=e.toRefs(n),b=I.useNamespace("virtual-list"),r=e.ref(),p=e.ref(),v=e.computed(()=>i.value.map((t,o)=>t[f.value]??o)),{frontPadding:h,behindPadding:g,start:a,end:P,getStartByScroll:q,setItemSize:x,hasItemSize:w,setStart:y,getScrollOffset:S}=M.useVirtualListSize({dataKeys:v,contentRef:p,fixedSize:z,estimatedSize:C,buffer:m}),u=e.computed(()=>s.isObject(n.component)?{container:"div",list:"div",content:"div",...n.component}:{container:n.component,list:"div",content:"div"}),R=e.computed(()=>({height:s.addUnit(L.value),overflow:"auto"})),U=e.computed(()=>n.paddingPosition==="list"?{paddingTop:s.addUnit(h.value),paddingBottom:s.addUnit(g.value)}:{}),V=e.computed(()=>n.paddingPosition==="content"?{paddingTop:s.addUnit(h.value),paddingBottom:s.addUnit(g.value)}:{}),O=e.computed(()=>n.threshold&&i.value.length<=n.threshold?i.value:i.value.slice(a.value,P.value)),D=t=>{const{scrollTop:o,scrollHeight:l,offsetHeight:c}=t.target,_=q(o);_!==a.value&&y(_),d("scroll",t),Math.floor(l-(o+c))<=0&&d("reachBottom",t)};return T({scrollTo:t=>{if(r.value)if(s.isNumber(t))r.value.scrollTop=t;else{const o=t.index??v.value.indexOf(t.key??"");y(o-m.value),r.value.scrollTop=S(o),e.nextTick(()=>{if(r.value){const l=S(o);l!==r.value.scrollTop&&(r.value.scrollTop=l)}})}}}),(t,o)=>(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(u).container),{ref_key:"containerRef",ref:r,class:e.normalizeClass(e.unref(b).b()),style:e.normalizeStyle(e.unref(R)),onScroll:D},{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(u).list),e.mergeProps(t.listAttrs,{style:e.unref(U)}),{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(u).content),e.mergeProps({ref_key:"contentRef",ref:p},t.contentAttrs,{style:e.unref(V)}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(O),(l,c)=>(e.openBlock(),e.createBlock(j.default,{key:l[e.unref(f)]??e.unref(a)+c,"has-item-size":e.unref(w),"set-item-size":e.unref(x)},{default:e.withCtx(()=>[e.renderSlot(t.$slots,"item",{item:l,index:e.unref(a)+c})]),_:2},1032,["has-item-size","set-item-size"]))),128))]),_:3},16,["style"]))]),_:3},16,["style"]))]),_:3},40,["class","style"]))}});exports.default=E;
