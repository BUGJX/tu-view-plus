"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),k=require("./virtual-list.js"),s=require("@tu-view-plus/utils"),M=require("@tu-view-plus/hooks"),j=require("./use-virtual-list-size.js"),A=require("./virtual-list-item.vue.js");require("../style/virtual-list.css");const E=e.defineComponent({name:"TuVirtualList"}),H=e.defineComponent({...E,props:k.virtualListProps,emits:k.virtualListEmits,setup(B,{expose:T,emit:z}){const n=B,d=z,{data:i,itemKey:m,fixedSize:C,estimatedSize:L,buffer:f,height:b}=e.toRefs(n),P=M.useNamespace("virtual-list"),l=e.ref(),p=e.ref(),v=e.computed(()=>i.value.map((t,o)=>t[m.value]??o)),{frontPadding:h,behindPadding:g,start:a,end:x,getStartByScroll:q,setItemSize:w,hasItemSize:R,setStart:y,getScrollOffset:S}=j.useVirtualListSize({dataKeys:v,contentRef:p,fixedSize:C,estimatedSize:L,buffer:f}),u=e.computed(()=>s.isObject(n.component)?{container:"div",list:"div",content:"div",...n.component}:{container:n.component,list:"div",content:"div"}),U=e.computed(()=>({height:s.addUnit(b.value),overflow:"auto"})),V=e.computed(()=>n.paddingPosition==="list"?{paddingTop:s.addUnit(h.value),paddingBottom:s.addUnit(g.value)}:{}),O=e.computed(()=>n.paddingPosition==="content"?{paddingTop:s.addUnit(h.value),paddingBottom:s.addUnit(g.value)}:{}),D=e.computed(()=>n.threshold&&i.value.length<=n.threshold?i.value:i.value.slice(a.value,x.value)),I=t=>{const{scrollTop:o,scrollHeight:r,offsetHeight:c}=t.target,_=q(o);_!==a.value&&y(_),d("scroll",t),Math.floor(r-(o+c))<=0&&d("reachBottom",t)};return T({scrollTo:t=>{if(l.value)if(s.isNumber(t))l.value.scrollTop=t;else{const o=t.index??v.value.indexOf(t.key??"");y(o-f.value),l.value.scrollTop=S(o),e.nextTick(()=>{if(l.value){const r=S(o);r!==l.value.scrollTop&&(l.value.scrollTop=r)}})}}}),(t,o)=>(e.openBlock(),e.createBlock(e.resolveDynamicComponent(u.value.container),{ref_key:"containerRef",ref:l,class:e.normalizeClass(e.unref(P).b()),style:e.normalizeStyle(U.value),onScroll:I},{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(u.value.list),e.mergeProps(t.listAttrs,{style:V.value}),{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(u.value.content),e.mergeProps({ref_key:"contentRef",ref:p},t.contentAttrs,{style:O.value}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.value,(r,c)=>(e.openBlock(),e.createBlock(A.default,{key:r[e.unref(m)]??e.unref(a)+c,"has-item-size":e.unref(R),"set-item-size":e.unref(w)},{default:e.withCtx(()=>[e.renderSlot(t.$slots,"item",{item:r,index:e.unref(a)+c})]),_:2},1032,["has-item-size","set-item-size"]))),128))]),_:3},16,["style"]))]),_:3},16,["style"]))]),_:3},40,["class","style"]))}});exports.default=H;
