"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("vue"),s=require("@tu-view-plus/utils"),d=require("../context.js");function M(r,o){const n=[],e=u=>{u.forEach(a=>{o(a)&&n.push(a.key),a.children&&e(a.children)})};return e(r),n}function p(r=!1){return r?void 0:t.inject(d.DataCollectorInjectionKey)}function b(r){const{key:o,type:n}=r,e=t.ref([]),u=p(n==="menu"),a={collectSubMenu(l,c,i=!1){const v={key:l,children:c};if(i){const f=e.value.find(y=>y.key===l);f?f.children=c:e.value.push(v)}else e.value=[...e.value,v];i&&(n==="popupMenu"?u==null||u.reportMenuData(e.value):n==="subMenu"&&!s.isUndefined(l)&&(u==null||u.collectSubMenu(l,e.value,!0)))},removeSubMenu(l){e.value=e.value.filter(c=>c.key!==l)},collectMenuItem(l){e.value.push({key:l})},removeMenuItem(l){e.value=e.value.filter(c=>c.key!==l)},reportMenuData(l){e.value=l,n==="subMenu"&&!s.isUndefined(o)&&(u==null||u.collectSubMenu(o,e.value,!0))}};return t.provide(d.DataCollectorInjectionKey,a),n==="subMenu"&&!s.isUndefined(o)?(t.onMounted(()=>{u==null||u.collectSubMenu(o,e.value)}),t.onUnmounted(()=>{u==null||u.removeSubMenu(o)})):n==="popupMenu"&&t.onMounted(()=>{u==null||u.reportMenuData(e.value)}),{menuData:e,subMenuKeys:t.computed(()=>M(e.value,l=>!!l.children)),menuItemKeys:t.computed(()=>M(e.value,l=>!l.children))}}exports.useMenuDataCollector=b;exports.useMenuDataCollectorContext=p;
