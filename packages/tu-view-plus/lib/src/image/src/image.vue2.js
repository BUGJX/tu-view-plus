"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),F=require("./image.js"),I=require("@tu-view-plus/hooks"),D=require("../hooks/use-image-load-status.js"),_=require("@tu-view-plus/utils"),V=require("../utils/normalize-image-size-prop.js"),H=require("./constants.js"),J=require("../../icon/index.js"),j=require("@tu-view-plus/icons-vue"),Q=require("./image-footer.vue.js"),W=require("./image-preview.vue.js");require("../style/image.css");let X=0;const Y=e.defineComponent({components:{Loading:j.Loading,Picture:j.Picture,ImageFooter:Q.default,ImagePreview:W.default,TuIcon:J.TuIcon},inheritAttrs:!1,name:"TuImage",props:F.imageProps,emits:F.imageEmits,setup(a,{attrs:s,slots:T,emit:P}){const{t:k}=I.useLocale(),i=I.useNamespace("image"),u=e.ref(),{height:n,width:l,hideFooter:c,title:v,description:m,src:t,footerPosition:q,defaultPreviewVisible:M,previewVisible:A,preview:d,previewProps:g}=e.toRefs(a),r=e.inject(H.PreviewGroupInjectionKey,void 0),{isLoaded:o,isError:S,isLoading:L,setLoadStatus:f}=D.default(),b=e.computed(()=>({width:V.normalizeImageSizeProp(l==null?void 0:l.value),height:V.normalizeImageSizeProp(n==null?void 0:n.value)})),B=e.computed(()=>a.fit?{objectFit:a.fit}:{}),G=e.computed(()=>({[i.b()]:!0,[i.m("loading")]:L.value,[i.m("loading-error")]:S.value,[i.m("with-footer-inner")]:o&&p&&q.value==="inner",[i.m("with-footer-outer")]:o&&p&&q.value==="outer",...s.class})),K=e.computed(()=>[b.value,s.style]),p=e.computed(()=>v!=null&&v.value||m!=null&&m.value||T.extra?_.isBoolean(c.value)?!c.value&&o.value:c.value==="never":!1),N=e.computed(()=>_.omit(s,["class","style"])),[O,h]=I.useMergeState(M.value,e.reactive({value:A})),R=e.computed(()=>!(r!=null&&r.preview)&&d.value);e.watchEffect(()=>{_.isServerRendering||!u.value||(u.value.src=t==null?void 0:t.value,f("loading"))});const y=X++;return e.watchEffect(U=>{var z,E;const w=(E=r==null?void 0:r.registerImageUrl)==null?void 0:E.call(r,y,(((z=g==null?void 0:g.value)==null?void 0:z.src)??(t==null?void 0:t.value))||"",d.value);U(()=>{w==null||w()})}),{t:k,wrapperClasses:G,wrapperStyles:K,imgProps:N,nsImage:i,sizeStyle:b,fitStyle:B,isLoaded:o,isError:S,isLoading:L,mergedPreviewVisible:O,mergePreview:R,showFooter:p,refImg:u,onImgLoaded:()=>{f("loaded")},onImgLoadError:()=>{f("error")},onImgClick:()=>{d.value&&(r!=null&&r.preview?r.preview(y):(P("preview-visible-change",!0),h(!0)))},onPreviewClose:()=>{P("preview-visible-change",!1),h(!1)}}}});exports.default=Y;
