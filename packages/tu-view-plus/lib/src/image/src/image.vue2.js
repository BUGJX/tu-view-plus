"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),T=require("./image.js"),I=require("@tu-view-plus/hooks"),D=require("../hooks/use-image-load-status.js"),_=require("@tu-view-plus/utils"),F=require("../utils/normalize-image-size-prop.js"),H=require("./constants.js"),J=require("../../icon/index.js"),V=require("@tu-view-plus/icons-vue"),Q=require("./image-footer.vue.js"),W=require("./preview.vue.js");require("../style/image.css");let X=0;const Y=e.defineComponent({components:{Loading:V.Loading,Picture:V.Picture,TuImageFooter:Q.default,TuPreview:W.default,TuIcon:J.TuIcon},inheritAttrs:!1,name:"TuImage",props:T.imageProps,emits:T.imageEmits,setup(s,{slots:j,emit:P}){const{t:k}=I.useLocale(),t=I.useNamespace("image"),a=e.ref(),u=e.useAttrs(),{height:n,width:l,hideFooter:c,title:v,description:m,src:i,footerPosition:q,defaultPreviewVisible:M,previewVisible:A,preview:d,previewProps:f}=e.toRefs(s),r=e.inject(H.PreviewGroupInjectionKey,void 0),{isLoaded:o,isError:S,isLoading:L,setLoadStatus:g}=D.default(),b=e.computed(()=>({width:F.normalizeImageSizeProp(l==null?void 0:l.value),height:F.normalizeImageSizeProp(n==null?void 0:n.value)})),B=e.computed(()=>s.fit?{objectFit:s.fit}:{}),G=e.computed(()=>({[t.b()]:!0,[t.m("loading")]:L.value,[t.m("loading-error")]:S.value,[t.m("with-footer-inner")]:o&&p&&q.value==="inner",[t.m("with-footer-outer")]:o&&p&&q.value==="outer",...u.class})),K=e.computed(()=>[b.value,u.style]),p=e.computed(()=>v!=null&&v.value||m!=null&&m.value||j.extra?_.isBoolean(c.value)?!c.value&&o.value:c.value==="never":!1),N=e.computed(()=>_.omit(u,["class","style"])),[O,h]=I.useMergeState(M.value,e.reactive({value:A})),R=e.computed(()=>!(r!=null&&r.preview)&&d.value);e.watchEffect(()=>{_.isServerRendering||!a.value||(a.value.src=i==null?void 0:i.value,g("loading"))});const y=X++;return e.watchEffect(U=>{var z,E;const w=(E=r==null?void 0:r.registerImageUrl)==null?void 0:E.call(r,y,(((z=f==null?void 0:f.value)==null?void 0:z.src)??(i==null?void 0:i.value))||"",d.value);U(()=>{w==null||w()})}),{t:k,wrapperClasses:G,wrapperStyles:K,imgProps:N,nsImage:t,sizeStyle:b,fitStyle:B,isLoaded:o,isError:S,isLoading:L,mergedPreviewVisible:O,mergePreview:R,showFooter:p,refImg:a,onImgLoaded:()=>{g("loaded")},onImgLoadError:()=>{g("error")},onImgClick:()=>{d.value&&(r!=null&&r.preview?r.preview(y):(P("preview-visible-change",!0),h(!0)))},onPreviewClose:()=>{P("preview-visible-change",!1),h(!1)}}}});exports.default=Y;
