"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),F=require("./image.js"),_=require("@tu-view-plus/hooks"),D=require("../hooks/use-image-load-status.js"),I=require("@tu-view-plus/utils"),V=require("../utils/normalize-image-size-prop.js"),H=require("./constants.js"),j=require("@tu-view-plus/icons-vue"),J=require("./image-footer.vue.js"),Q=require("./preview.vue.js");require("../style/image.css");let W=0;const X=e.defineComponent({components:{Loading:j.Loading,Picture:j.Picture,TuImageFooter:J.default,TuPreview:Q.default},inheritAttrs:!1,name:"TuImage",props:F.imageProps,emits:F.imageEmits,setup(s,{slots:T,emit:P}){const{t:k}=_.useLocale(),t=_.useNamespace("image"),a=e.ref(),u=e.useAttrs(),{height:n,width:l,hideFooter:c,title:v,description:m,src:i,footerPosition:S,defaultPreviewVisible:M,previewVisible:A,preview:d,previewProps:f}=e.toRefs(s),r=e.inject(H.PreviewGroupInjectionKey,void 0),{isLoaded:o,isError:q,isLoading:L,setLoadStatus:g}=D.default(),b=e.computed(()=>({width:V.normalizeImageSizeProp(l==null?void 0:l.value),height:V.normalizeImageSizeProp(n==null?void 0:n.value)})),B=e.computed(()=>s.fit?{objectFit:s.fit}:{}),G=e.computed(()=>({[t.b()]:!0,[t.m("loading")]:L.value,[t.m("loading-error")]:q.value,[t.m("with-footer-inner")]:o&&p&&S.value==="inner",[t.m("with-footer-outer")]:o&&p&&S.value==="outer",...u.class})),K=e.computed(()=>[b.value,u.style]),p=e.computed(()=>v!=null&&v.value||m!=null&&m.value||T.extra?I.isBoolean(c.value)?!c.value&&o.value:c.value==="never":!1),N=e.computed(()=>I.omit(u,["class","style"])),[O,h]=_.useMergeState(M.value,e.reactive({value:A})),R=e.computed(()=>!(r!=null&&r.preview)&&d.value);e.watchEffect(()=>{I.isServerRendering||!a.value||(a.value.src=i==null?void 0:i.value,g("loading"))});const y=W++;return e.watchEffect(U=>{var z,E;const w=(E=r==null?void 0:r.registerImageUrl)==null?void 0:E.call(r,y,(((z=f==null?void 0:f.value)==null?void 0:z.src)??(i==null?void 0:i.value))||"",d.value);U(()=>{w==null||w()})}),{t:k,wrapperClasses:G,wrapperStyles:K,imgProps:N,nsImage:t,sizeStyle:b,fitStyle:B,isLoaded:o,isError:q,isLoading:L,mergedPreviewVisible:O,mergePreview:R,showFooter:p,refImg:a,onImgLoaded:()=>{g("loaded")},onImgLoadError:()=>{g("error")},onImgClick:()=>{d.value&&(r!=null&&r.preview?r.preview(y):(P("preview-visible-change",!0),h(!0)))},onPreviewClose:()=>{P("preview-visible-change",!1),h(!1)}}}});exports.default=X;
