"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),U=require("./image-preview-group.js"),h=require("@tu-view-plus/hooks"),u=require("@tu-view-plus/utils"),V=require("./image-preview.vue.js"),F=require("./constants.js"),K=t.defineComponent({name:"TuImagePreviewGroup",inheritAttrs:!1}),L=t.defineComponent({...K,props:U.imagePreviewGroupProps,emits:U.imagePreviewGroupEmits,setup(M,{emit:_}){const k=M,d=_,{srcList:s,visible:S,defaultVisible:q,current:G,defaultCurrent:A,infinite:P}=t.toRefs(k),[w,$]=h.useMergeState(q.value,t.reactive({value:S})),y=e=>{e!==w.value&&(d("visible-change",e),d("update:visible",e),$(e))},l=t.computed(()=>new Map(u.isArray(s==null?void 0:s.value)?s==null?void 0:s.value.map((e,r)=>[r,{url:e,canPreview:!0}]):[])),o=t.ref(new Map(l.value||[])),i=t.computed(()=>Array.from(o.value.keys())),I=t.computed(()=>i.value.length),B=(e,r,c)=>(l.value.has(e)||o.value.set(e,{url:r,canPreview:c}),function(){l.value.has(e)||o.value.delete(e)});t.watch(l,()=>{o.value=new Map(l.value||[])});const[a,N]=h.useMergeState(A.value,t.reactive({value:G})),m=e=>{e!==a.value&&(d("change",e),d("update:current",e),N(e))},T=t.computed(()=>i.value[a.value]),j=e=>{const r=i.value.indexOf(e);r!==a.value&&m(r)},C=t.computed(()=>{var e;return(e=o.value.get(T.value))==null?void 0:e.url});t.provide(F.PreviewGroupInjectionKey,t.reactive({registerImageUrl:B,preview:e=>{y(!0),j(e)}}));const f=t.computed(()=>{const e=(c,p)=>{var v;for(let n=c;n<=p;n++){const b=i.value[n];if((v=o.value.get(b))!=null&&v.canPreview)return n}},r=e(a.value+1,I.value-1);return u.isUndefined(r)&&P.value?e(0,a.value-1):r}),g=t.computed(()=>{const e=(c,p)=>{var v;for(let n=c;n>=p;n--){const b=i.value[n];if((v=o.value.get(b))!=null&&v.canPreview)return n}},r=e(a.value-1,0);return u.isUndefined(r)&&P.value?e(I.value-1,a.value+1):r}),x=t.computed(()=>u.isUndefined(g.value)?void 0:()=>{!u.isUndefined(g.value)&&m(g.value)}),E=t.computed(()=>u.isUndefined(f.value)?void 0:()=>{!u.isUndefined(f.value)&&m(f.value)}),O=t.reactive({onPrev:x,onNext:E}),R=()=>{y(!1)};return(e,r)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.renderSlot(e.$slots,"default"),t.createVNode(V.default,t.mergeProps({"in-group":""},{...e.$attrs,groupArrowProps:O},{src:C.value,visible:t.unref(w),"mask-closable":e.maskClosable,closable:e.closable,"actions-layout":e.actionsLayout,"popup-container":e.popupContainer,"render-to-body":e.renderToBody,onClose:R}),t.createSlots({_:2},[e.$slots.actions?{name:"actions",fn:t.withCtx(()=>[t.renderSlot(e.$slots,"actions",{url:C.value})]),key:"0"}:void 0]),1040,["src","visible","mask-closable","closable","actions-layout","popup-container","render-to-body"])],64))}});exports.default=L;
