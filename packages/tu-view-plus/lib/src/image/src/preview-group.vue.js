"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),U=require("./preview-group.js"),h=require("@tu-view-plus/hooks"),a=require("@tu-view-plus/utils"),V=require("./preview.vue.js"),F=require("./constants.js"),K=t.defineComponent({name:"TuPreviewGroup",inheritAttrs:!1}),L=t.defineComponent({...K,props:U.previewGroupProps,emits:U.previewGroupEmits,setup(M,{emit:_}){const k=M,d=_,{srcList:s,visible:S,defaultVisible:q,current:G,defaultCurrent:A,infinite:w}=t.toRefs(k),[y,$]=h.useMergeState(q.value,t.reactive({value:S})),P=e=>{e!==y.value&&(d("visible-change",e),d("update:visible",e),$(e))},l=t.computed(()=>new Map(a.isArray(s==null?void 0:s.value)?s==null?void 0:s.value.map((e,r)=>[r,{url:e,canPreview:!0}]):[])),o=t.ref(new Map(l.value||[])),i=t.computed(()=>Array.from(o.value.keys())),C=t.computed(()=>i.value.length),B=(e,r,c)=>(l.value.has(e)||o.value.set(e,{url:r,canPreview:c}),function(){l.value.has(e)||o.value.delete(e)});t.watch(l,()=>{o.value=new Map(l.value||[])});const[u,N]=h.useMergeState(A.value,t.reactive({value:G})),f=e=>{e!==u.value&&(d("change",e),d("update:current",e),N(e))},T=t.computed(()=>i.value[u.value]),j=e=>{const r=i.value.indexOf(e);r!==u.value&&f(r)},I=t.computed(()=>{var e;return(e=o.value.get(T.value))==null?void 0:e.url});t.provide(F.PreviewGroupInjectionKey,t.reactive({registerImageUrl:B,preview:e=>{console.log("imag",e),P(!0),j(e)}}));const m=t.computed(()=>{const e=(c,p)=>{var v;for(let n=c;n<=p;n++){const b=i.value[n];if((v=o.value.get(b))!=null&&v.canPreview)return n}},r=e(u.value+1,C.value-1);return a.isUndefined(r)&&w.value?e(0,u.value-1):r}),g=t.computed(()=>{const e=(c,p)=>{var v;for(let n=c;n>=p;n--){const b=i.value[n];if((v=o.value.get(b))!=null&&v.canPreview)return n}},r=e(u.value-1,0);return a.isUndefined(r)&&w.value?e(C.value-1,u.value+1):r}),x=t.computed(()=>a.isUndefined(g.value)?void 0:()=>{!a.isUndefined(g.value)&&f(g.value)}),E=t.computed(()=>a.isUndefined(m.value)?void 0:()=>{!a.isUndefined(m.value)&&f(m.value)}),O=t.reactive({onPrev:x,onNext:E}),R=()=>{P(!1)};return(e,r)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.renderSlot(e.$slots,"default"),t.createVNode(V.default,t.mergeProps({"in-group":""},{...e.$attrs,groupArrowProps:O},{src:I.value,visible:t.unref(y),"mask-closable":e.maskClosable,closable:e.closable,"actions-layout":e.actionsLayout,"popup-container":e.popupContainer,"render-to-body":e.renderToBody,onClose:R}),t.createSlots({_:2},[e.$slots.actions?{name:"actions",fn:t.withCtx(()=>[t.renderSlot(e.$slots,"actions",{url:I.value})]),key:"0"}:void 0]),1040,["src","visible","mask-closable","closable","actions-layout","popup-container","render-to-body"])],64))}});exports.default=L;
