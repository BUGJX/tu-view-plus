"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),Z=require("@vueuse/core"),F=require("./textarea.js"),I=require("@tu-view-plus/hooks"),_=require("../../icon/index.js"),ee=require("./use-textarea.js"),M=require("@tu-view-plus/utils"),te=require("@tu-view-plus/icons-vue");require("../../form/index.js");require("../style/textarea.css");const E=require("../../form/src/hooks/use-form-props.js"),N=require("../../form/src/hooks/use-form-item.js"),re=["role"],oe=["id","tabindex","disabled","readonly","autocomplete","aria-label","placeholder","form"],ne=e.defineComponent({name:"TuTextarea",inheritAttrs:!1}),ae=e.defineComponent({...ne,props:F.textareaProps,emits:F.textareaEmits,setup(R,{expose:D,emit:P}){const n=R,u=e.shallowRef(),a=I.useNamespace("textarea"),m=E.useFormSize(),l=E.useFormDisabled(),i=I.useComponentAttrs({excludeKeys:e.computed(()=>Object.keys(V.value))}),d=e.ref(),{form:L,formItem:s}=N.useFormItem(),{inputId:W}=N.useFormItemInputId(n,{formItemContext:s}),{textareaRef:K,isHovering:O,isFocused:p,textareaCalcStyle:j,textLength:x,nativeTextareaValue:v,focus:H,blur:U,select:$,clear:y,handleMouseEnter:b,handleMouseLeave:C,handleCompositionStart:h,handleCompositionUpdate:S,handleCompositionEnd:g,handleInput:w,handleFocus:k,handleBlur:z,handleChange:T,handleKeydown:q,setNativeTextareaValue:A,resizeTextarea:f,onceInitSizeTextarea:G}=ee.default(n,P,u),J=e.computed(()=>n.clearable&&!l.value&&!n.readonly&&!!v.value&&(p.value||O.value)),c=e.computed(()=>n.showWordLimit&&!!i.value.maxlength&&!l.value&&!n.readonly),Q=e.computed(()=>!!c.value&&x.value>Number(i.value.maxlength)),X=e.computed(()=>({[a.b()]:!0,[a.m(m.value)]:m.value,[a.is("disabled")]:l.value,[a.is("exceed")]:Q.value,[a.is("focus")]:p.value,[e.useAttrs().class]:e.useAttrs().class})),Y=e.computed(()=>[e.useAttrs().style,n.textareaStyle]),V=e.computed(()=>{const o={};return n.containerRole==="combobox"&&(o["aria-haspopup"]=e.useAttrs()["aria-haspopup"],o["aria-owns"]=e.useAttrs()["aria-owns"],o["aria-expanded"]=e.useAttrs()["aria-expanded"]),o}),B=e.computed(()=>[n.textareaStyle,j.value,{resize:n.resize}]);return Z.useResizeObserver(u,o=>{if(G(),!c.value||n.resize!=="both")return;const t=o[0],{width:r}=t.contentRect;d.value={right:`calc(100% - ${r+16}px)`}}),e.watch(v,()=>A()),e.watch(()=>n.modelValue,()=>{var o;e.nextTick(()=>f()),n.validateEvent&&((o=s==null?void 0:s.validate)==null||o.call(s,"change").catch(t=>M.debugWarn(t)))}),e.onMounted(()=>{!n.formatter&&n.parser&&M.debugWarn("TuTextarea","If you set the parser, you also need to set the formatter."),A(),e.nextTick(f)}),D({textarea:u,ref:K,textareaStyle:B,autosize:e.toRef(n,"autosize"),focus:H,blur:U,select:$,clear:y,resizeTextarea:f}),(o,t)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",e.mergeProps(e.unref(V),{class:e.unref(X),style:e.unref(Y),role:o.containerRole,onMouseenter:t[9]||(t[9]=(...r)=>e.unref(b)&&e.unref(b)(...r)),onMouseleave:t[10]||(t[10]=(...r)=>e.unref(C)&&e.unref(C)(...r))}),[e.createElementVNode("textarea",e.mergeProps({ref_key:"textarea",ref:u},e.unref(i),{id:e.unref(W),class:e.unref(a).e("inner"),tabindex:o.tabindex,disabled:e.unref(l),readonly:o.readonly,autocomplete:o.autocomplete,style:e.unref(B),"aria-label":o.label,placeholder:o.placeholder,form:e.unref(L),onCompositionstart:t[0]||(t[0]=(...r)=>e.unref(h)&&e.unref(h)(...r)),onCompositionupdate:t[1]||(t[1]=(...r)=>e.unref(S)&&e.unref(S)(...r)),onCompositionend:t[2]||(t[2]=(...r)=>e.unref(g)&&e.unref(g)(...r)),onInput:t[3]||(t[3]=(...r)=>e.unref(w)&&e.unref(w)(...r)),onFocus:t[4]||(t[4]=(...r)=>e.unref(k)&&e.unref(k)(...r)),onBlur:t[5]||(t[5]=(...r)=>e.unref(z)&&e.unref(z)(...r)),onChange:t[6]||(t[6]=(...r)=>e.unref(T)&&e.unref(T)(...r)),onKeydown:t[7]||(t[7]=(...r)=>e.unref(q)&&e.unref(q)(...r))}),null,16,oe),e.unref(c)?(e.openBlock(),e.createElementBlock("span",{key:0,style:e.normalizeStyle(d.value),class:e.normalizeClass(e.unref(a).e("count"))},e.toDisplayString(e.unref(x))+" / "+e.toDisplayString(e.unref(i).maxlength),7)):e.createCommentVNode("",!0),e.unref(J)?(e.openBlock(),e.createBlock(e.unref(_.TuIcon),{key:1,style:e.normalizeStyle(d.value),class:e.normalizeClass([e.unref(a).e("icon"),e.unref(a).em("icon","clear")]),onMousedown:t[8]||(t[8]=e.withModifiers(()=>{},["prevent"])),onClick:e.unref(y)},{default:e.withCtx(()=>[e.createVNode(e.unref(te.Close))]),_:1},8,["style","class","onClick"])):e.createCommentVNode("",!0)],16,re)),[[e.vShow,o.type!=="hidden"]])}});exports.default=ae;
