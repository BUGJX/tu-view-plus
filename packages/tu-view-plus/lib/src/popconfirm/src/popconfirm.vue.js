"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),y=require("./popconfirm.js"),S=require("../../trigger/index.js"),q=require("../../icon/index.js"),k=require("../../button/index.js"),g=require("@tu-view-plus/hooks"),r=require("@tu-view-plus/utils");require("../style/popconfirm.css");const E=e.defineComponent({name:"TuPopconfirm"}),D=e.defineComponent({...E,props:y.popconfirmProps,emits:y.popconfirmEmits,setup(V,{emit:a}){const n=V;let l=0;const{t:f}=g.useLocale(),t=g.useNamespace("popconfirm"),c=e.ref(n.defaultPopupVisible),i=e.ref(!1),w=e.computed(()=>n.popupVisible??c.value),B=e.computed(()=>n.okLoading||i.value),m=e.computed(()=>r.TypeComponentsMap[n.type]||""),h=e.computed(()=>{const o=n.type;return{[t.em("icon",o)]:o&&r.TypeComponentsMap[o]}}),b=e.computed(()=>({[t.b()]:!0,[t.m(n.size)]:n.size})),P=e.computed(()=>[t.e("popup-content"),n.contentClass]),T=e.computed(()=>[t.e("popup-arrow"),n.arrowClass]),p=()=>{l++,i.value&&(i.value=!1),c.value=!1,a("update:popupVisible",!1),a("popupVisibleChange",!1)},v=o=>{o?(c.value=o,a("update:popupVisible",o),a("popupVisibleChange",o)):p()},N=()=>{let o=!0;r.isFunction(n.onBeforeCancel)&&(o=n.onBeforeCancel()??!1),o&&(a("cancel"),p())},z=async()=>{const o=l,d=await new Promise(async u=>{if(r.isFunction(n.onBeforeOk)){let s=n.onBeforeOk((C=!0)=>u(C));if((r.isPromise(s)||!r.isBoolean(s))&&(i.value=!0),r.isPromise(s))try{s=await s??!0}catch{s=!1}r.isBoolean(s)&&u(s)}else u(!0)});o===l&&(d?(a("ok"),p()):i.value&&(i.value=!1))};return(o,d)=>(e.openBlock(),e.createBlock(e.unref(S.TuTrigger),{"show-arrow":"",trigger:"click","animation-name":"zoom-in-fade-out","auto-fit-transform-origin":"",class:e.normalizeClass(e.unref(b)),position:o.position,"popup-visible":e.unref(w),"popup-offset":14,"popup-container":o.popupContainer,"content-class":e.unref(P),"content-style":o.contentStyle,"arrow-class":e.unref(T),"arrow-style":o.arrowStyle,onPopupVisibleChange:v},{content:e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(e.unref(t).e("body"))},[o.type?(e.openBlock(),e.createElementBlock("span",{key:0,class:e.normalizeClass([e.unref(t).e("icon"),e.unref(h)])},[e.unref(m)?(e.openBlock(),e.createBlock(e.unref(q.TuIcon),{key:0},{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(m))))]),_:1})):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0),e.createElementVNode("span",{class:e.normalizeClass(e.unref(t).e("content"))},[e.renderSlot(o.$slots,"content",{},()=>[e.createTextVNode(e.toDisplayString(o.content),1)])],2)],2),e.createElementVNode("div",{class:e.normalizeClass(e.unref(t).e("footer"))},[e.createVNode(e.unref(k.TuButton),e.mergeProps({size:"mini"},o.cancelButtonProps,{onClick:N}),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.cancelText||e.unref(f)("tu.modal.cancel")),1)]),_:1},16),e.createVNode(e.unref(k.TuButton),e.mergeProps({size:"mini",type:"primary"},o.okButtonProps,{loading:e.unref(B),onClick:z}),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.okText||e.unref(f)("tu.modal.confirm")),1)]),_:1},16,["loading"])],2)]),default:e.withCtx(()=>[e.renderSlot(o.$slots,"default")]),_:3},8,["class","position","popup-visible","popup-container","content-class","content-style","arrow-class","arrow-style"]))}});exports.default=D;
