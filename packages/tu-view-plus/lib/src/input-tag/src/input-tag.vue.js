"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),F=require("./input-tag.js"),R=require("@tu-view-plus/hooks"),$=require("@tu-view-plus/constants"),C=require("@tu-view-plus/utils"),de=require("@tu-view-plus/icons-vue"),pe=require("../../resize-observer/index.js"),fe=require("./utils.js");require("../../form/index.js");const ve=require("../../tag/index.js"),A=require("../../icon/index.js");require("../style/input-tag.css");const L=require("../../form/src/hooks/use-form-props.js"),me=require("../../form/src/hooks/use-form-item.js"),ge=["placeholder","disabled","readonly"],Ve=e.defineComponent({name:"TuInputTag"}),he=e.defineComponent({...Ve,props:F.inputTagProps,emits:F.inputTagEmits,setup(O,{emit:U}){const W={value:"value",label:"label",closable:"closable",tagProps:"tagProps"},l=O,r=U,_=e.useAttrs(),b=e.useSlots(),u=R.useNamespace("input-tag"),E=L.useFormSize(),v=L.useFormDisabled(),{form:T,formItem:k}=me.useFormItem(),I=e.reactive({width:"12px"}),p=e.ref(),s=e.ref(),c=e.ref(!1),x=e.ref(!1),m=e.ref(""),j=e.computed(()=>({...W,...l.fieldNames})),N=e.ref(!1),z=e.ref(l.defaultValue),S=e.ref(l.defaultInputValue),K=e.computed(()=>C.omit(_,$.INPUT_EVENTS)),G=e.computed(()=>C.pick(_,$.INPUT_EVENTS)),H=e.computed(()=>g.value.length>0?m.value||o.value:m.value||o.value||l.placeholder),f=e.computed(()=>l.modelValue??z.value),o=e.computed(()=>l.inputValue??S.value),d=e.computed(()=>fe.getValueData(f.value,j.value)),J=e.computed(()=>["small","mini"].indexOf(l.size)>-1?"mini":l.size==="large"?"medium":"small"),g=e.computed(()=>{if(l.maxTagCount>0){const a=d.value.length-l.maxTagCount;if(a>0){const t=d.value.slice(0,l.maxTagCount),n={value:"__tu__more",label:`${a}..`,closable:!1};return t.push({raw:n,...n}),t}}return d.value}),Q=e.computed(()=>!v.value&&!l.readonly&&l.clearable&&!!f.value.length&&x.value),X=e.computed(()=>(T==null?void 0:T.statusIcon)??!1),V=e.computed(()=>(k==null?void 0:k.validateState)||""),q=e.computed(()=>C.isObject(l.retainInputValue)?{create:!1,blur:!1,...l.retainInputValue}:{create:l.retainInputValue,blur:l.retainInputValue}),D=e.computed(()=>V.value&&C.ValidateComponentsMap[V.value]),Y=e.computed(()=>({[u.b()]:!0,[u.m(E.value)]:E.value,[u.m("has-prefix")]:!!b.prefix,[u.m("has-suffix")]:!!b.suffix,[u.is("disabled")]:v.value})),Z=a=>{x.value=!0,r("mouseenter",a)},ee=a=>{x.value=!1,r("mouseleave",a)},ae=a=>{s.value&&a.target!==s.value&&(a.preventDefault(),s.value.focus())},te=()=>{p.value&&M(p.value.offsetWidth)},le=a=>{const{value:t}=a.target;c.value||(h(t,a),e.nextTick(()=>{s.value&&o.value!==s.value.value&&(s.value.value=o.value)}))},ne=a=>{const t=a.key||a.code;if(!c.value&&o.value&&t==="Enter"&&re(a),!c.value&&g.value.length>0&&!o.value&&t==="Backspace"){const n=ie();n>=0&&P(d.value[n].value,n,a)}},ue=a=>{N.value=!0,r("focus",a)},oe=a=>{N.value=!1,!q.value.blur&&o.value&&h("",a),r("blur",a)},w=a=>{const{value:t}=a.target;a.type==="compositionend"?(c.value=!1,m.value="",h(t,a),e.nextTick(()=>{s.value&&o.value!==s.value.value&&(s.value.value=o.value)})):(c.value=!0,m.value=o.value+(a.data??""))},se=a=>{y([],a),r("clear",a)},P=(a,t,n)=>{var i;const B=(i=f.value)==null?void 0:i.filter((Ce,ce)=>ce!==t);y(B,n),r("remove",a,n)},re=a=>{var t;if(o.value){if(a.preventDefault(),l.uniqueValue&&((t=f.value)!=null&&t.includes(o.value))){r("pressEnter",o.value,a);return}const n=f.value.concat(o.value);y(n,a),r("pressEnter",o.value,a),q.value.create||h("",a)}},h=(a,t)=>{S.value=a,r("update:inputValue",a),r("inputValueChange",a,t)},ie=()=>{for(let a=d.value.length-1;a>=0;a--)if(d.value[a].closable)return a;return-1},y=(a,t)=>{z.value=a,r("update:modelValue",a),r("change",a,t)},M=a=>{a>12?I.width=`${a}px`:I.width="12px"};return e.watch(o,a=>{s.value&&!c.value&&a!==s.value.value&&(s.value.value=a)}),e.onMounted(()=>{p.value&&M(p.value.offsetWidth)}),(a,t)=>(e.openBlock(),e.createElementBlock("div",e.mergeProps({class:Y.value},K.value,{onMousedown:ae,onMouseenter:Z,onMouseleave:ee}),[e.createVNode(e.unref(pe.TuResizeObserver),{onResize:te},{default:e.withCtx(()=>[e.createElementVNode("span",{ref_key:"mirrorRef",ref:p,class:e.normalizeClass(e.unref(u).e("mirror"))},e.toDisplayString(H.value),3)]),_:1}),e.unref(b).prefix?(e.openBlock(),e.createElementBlock("span",{key:0,class:e.normalizeClass(e.unref(u).e("prefix"))},[e.renderSlot(a.$slots,"prefix")],2)):e.createCommentVNode("",!0),e.createVNode(e.TransitionGroup,{tag:"span",name:`${e.unref(R.defaultNamespace)}-input-tag-zoom`,class:e.normalizeClass(e.unref(u).e("inner"))},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value,(n,B)=>(e.openBlock(),e.createBlock(e.unref(ve.TuTag),e.mergeProps({closable:""},n.tagProps,{disableTransitions:"",size:J.value,key:`tag-${n.value}`,class:e.unref(u).e("tag"),disabled:e.unref(v),onClose:i=>P(n.value,B,i)}),{default:e.withCtx(()=>{var i;return[e.createTextVNode(e.toDisplayString(((i=a.formatTag)==null?void 0:i.call(a,n.raw))??n.label),1)]}),_:2},1040,["size","class","disabled","onClose"]))),128)),e.createElementVNode("input",e.mergeProps({ref_key:"inputRef",ref:s,key:"input-tag-input"},G.value,{class:e.unref(u).e("input"),style:I,placeholder:g.value.length===0?l.placeholder:void 0,disabled:e.unref(v),readonly:l.readonly||l.disabledInput,onInput:le,onKeydown:ne,onFocus:ue,onBlur:oe,onCompositionstart:w,onCompositionupdate:w,onCompositionend:w}),null,16,ge)]),_:1},8,["name","class"]),e.createElementVNode("span",{class:e.normalizeClass(e.unref(u).e("suffix"))},[Q.value?(e.openBlock(),e.createBlock(e.unref(A.TuIcon),{key:0,class:e.normalizeClass([e.unref(u).e("icon"),e.unref(u).em("icon","clear")]),onClick:se,onMousedown:t[0]||(t[0]=n=>n.stopPropagation())},{default:e.withCtx(()=>[e.createVNode(e.unref(de.Close))]),_:1},8,["class"])):e.createCommentVNode("",!0),V.value&&D.value&&X.value?(e.openBlock(),e.createBlock(e.unref(A.TuIcon),{key:1,class:e.normalizeClass([e.unref(u).e("icon"),e.unref(u).e("validateIcon"),e.unref(u).is("loading",V.value==="validating")])},{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(D.value)))]),_:1},8,["class"])):e.createCommentVNode("",!0)],2)],16))}});exports.default=he;
