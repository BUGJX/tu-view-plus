"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),S=require("@vueuse/core"),w=require("@tu-view-plus/utils"),P=require("@tu-view-plus/hooks"),B=require("./constants.js"),_=require("./util.js"),H=require("./thumb.js"),N="Thumb",x=e.defineComponent({__name:"thumb",props:H.thumbProps,setup(y){const u=y,n=e.inject(B.scrollbarContextKey),v=P.useNamespace("scrollbar"),C=P.useNamespace("scrollbar-fade");n||w.throwError(N,"can not inject scrollbar context");const r=e.ref(),s=e.ref(),m=e.ref({}),c=e.ref(!1);let i=!1,f=!1,d=w.isClient?document.onselectstart:null;const t=e.computed(()=>_.BAR_MAP[u.vertical?"vertical":"horizontal"]),k=e.computed(()=>_.renderThumbStyle({size:u.size,move:u.move,bar:t.value})),h=e.computed(()=>r.value[t.value.offset]**2/n.wrapElement[t.value.scrollSize]/u.ratio/s.value[t.value.offset]),z=o=>{var a;if(o.stopPropagation(),o.ctrlKey||[1,2].includes(o.button))return;(a=window.getSelection())==null||a.removeAllRanges(),L(o);const l=o.currentTarget;l&&(m.value[t.value.axis]=l[t.value.offset]-(o[t.value.client]-l.getBoundingClientRect()[t.value.direction]))},M=o=>{if(!s.value||!r.value||!n.wrapElement)return;const l=Math.abs(o.target.getBoundingClientRect()[t.value.direction]-o[t.value.client]),a=s.value[t.value.offset]/2,p=(l-a)*100*h.value/r.value[t.value.offset];n.wrapElement[t.value.scroll]=p*n.wrapElement[t.value.scrollSize]/100},L=o=>{o.stopImmediatePropagation(),i=!0,document.addEventListener("mousemove",E),document.addEventListener("mouseup",b),d=document.onselectstart,document.onselectstart=()=>!1},E=o=>{if(!r.value||!s.value||i===!1)return;const l=m.value[t.value.axis];if(!l)return;const a=(r.value.getBoundingClientRect()[t.value.direction]-o[t.value.client])*-1,p=s.value[t.value.offset]-l,q=(a-p)*100*h.value/r.value[t.value.offset];n.wrapElement[t.value.scroll]=q*n.wrapElement[t.value.scrollSize]/100},b=()=>{i=!1,m.value[t.value.axis]=0,document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",b),g(),f&&(c.value=!1)},R=()=>{f=!1,c.value=!!u.size},T=()=>{f=!0,c.value=i};e.onBeforeUnmount(()=>{g(),document.removeEventListener("mouseup",b)});const g=()=>{document.onselectstart!==d&&(document.onselectstart=d)};return S.useEventListener(e.toRef(n,"scrollbarElement"),"mousemove",R),S.useEventListener(e.toRef(n,"scrollbarElement"),"mouseleave",T),(o,l)=>(e.openBlock(),e.createBlock(e.Transition,{name:e.unref(C).b()},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",{ref_key:"instance",ref:r,class:e.normalizeClass([e.unref(v).e("bar"),e.unref(v).is(t.value.key)]),onMousedown:M},[e.createElementVNode("div",{ref_key:"thumb",ref:s,class:e.normalizeClass(e.unref(v).e("thumb")),style:e.normalizeStyle(k.value),onMousedown:z},null,38)],34),[[e.vShow,o.always||c.value]])]),_:1},8,["name"]))}});exports.default=x;
