"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),i=require("@vueuse/core"),S=require("./affix.js"),v=require("@tu-view-plus/utils"),q=require("@tu-view-plus/hooks");require("../style/affix.css");const z=e.defineComponent({name:"TuAffix"}),$=e.defineComponent({...z,props:S.affixProps,emits:S.affixEmits,setup(E,{emit:d}){const t=E,p=q.useNamespace("affix"),n=e.shallowRef(),c=e.shallowRef(),a=e.shallowRef(),l=e.ref(!1),m=e.ref(0),s=e.ref(0),{height:r}=i.useWindowSize(),{height:u,width:h,top:g,bottom:x,update:w}=i.useElementBounding(c,{windowScroll:!1}),f=i.useElementBounding(n),_=e.computed(()=>({height:l.value?`${u.value}px`:"",width:l.value?`${h.value}px`:""})),y=e.computed(()=>{if(!l.value)return{};const o=t.offset?v.addUnit(t.offset):0;return{height:`${u.value}px`,width:`${h.value}px`,top:t.position==="top"?o:"",bottom:t.position==="bottom"?o:"",transform:s.value?`translateY(${s.value}px)`:"",zIndex:t.zIndex}}),T=()=>{if(a.value)if(m.value=a.value instanceof Window?document.documentElement.scrollTop:a.value.scrollTop||0,t.position==="top")if(t.target){const o=f.bottom.value-t.offset-u.value;l.value=t.offset>g.value&&f.bottom.value>0,s.value=o<0?o:0}else l.value=t.offset>g.value;else if(t.target){const o=r.value-f.top.value-t.offset-u.value;l.value=r.value-t.offset<x.value&&r.value>f.top.value,s.value=o<0?-o:0}else l.value=r.value-t.offset<x.value},b=()=>{w(),d("scroll",{scrollTop:m.value,fixed:l.value})};return e.watch(l,o=>d("change",o)),i.useEventListener(a,"scroll",b),e.watchEffect(T),e.onMounted(()=>{t.target?(n.value=document.querySelector(t.target)??void 0,n.value||v.throwError("TuAffix",`Target is not existed: ${t.target}`)):n.value=document.documentElement,a.value=v.getScrollContainer(c.value,!0),w()}),(o,C)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"root",ref:c,class:e.normalizeClass(e.unref(p).b()),style:e.normalizeStyle(e.unref(_))},[e.createElementVNode("div",{class:e.normalizeClass({[e.unref(p).m("fixed")]:l.value}),style:e.normalizeStyle(e.unref(y))},[e.renderSlot(o.$slots,"default")],6)],6))}});exports.default=$;
