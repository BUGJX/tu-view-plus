"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),i=require("@vueuse/core"),E=require("./affix.js"),d=require("@tu-view-plus/utils"),z=require("@tu-view-plus/hooks");require("../style/affix.css");const $=e.defineComponent({name:"TuAffix"}),C=e.defineComponent({...$,props:E.affixProps,emits:E.affixEmits,setup(_,{expose:y,emit:p}){const t=_,m=z.useNamespace("affix"),n=e.shallowRef(),c=e.shallowRef(),a=e.shallowRef(),l=e.ref(!1),h=e.ref(0),s=e.ref(0),{height:r}=i.useWindowSize(),{height:u,width:g,top:x,bottom:w,update:v}=i.useElementBounding(c,{windowScroll:!1}),f=i.useElementBounding(n),T=e.computed(()=>({height:l.value?`${u.value}px`:"",width:l.value?`${g.value}px`:""})),b=e.computed(()=>{if(!l.value)return{};const o=t.offset?d.addUnit(t.offset):0;return{height:`${u.value}px`,width:`${g.value}px`,top:t.position==="top"?o:"",bottom:t.position==="bottom"?o:"",transform:s.value?`translateY(${s.value}px)`:"",zIndex:t.zIndex}}),S=()=>{if(a.value)if(h.value=a.value instanceof Window?document.documentElement.scrollTop:a.value.scrollTop||0,t.position==="top")if(t.target){const o=f.bottom.value-t.offset-u.value;l.value=t.offset>x.value&&f.bottom.value>0,s.value=o<0?o:0}else l.value=t.offset>x.value;else if(t.target){const o=r.value-f.top.value-t.offset-u.value;l.value=r.value-t.offset<w.value&&r.value>f.top.value,s.value=o<0?-o:0}else l.value=r.value-t.offset<w.value},q=()=>{v(),p("scroll",{scrollTop:h.value,fixed:l.value})};return e.watch(l,o=>p("change",o)),i.useEventListener(a,"scroll",q),e.watchEffect(S),e.onMounted(()=>{t.target?(n.value=document.querySelector(t.target)??void 0,n.value||d.throwError("TuAffix",`Target is not existed: ${t.target}`)):n.value=document.documentElement,a.value=d.getScrollContainer(c.value,!0),v()}),y({update:S,updateRoot:v}),(o,B)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"root",ref:c,class:e.normalizeClass(e.unref(m).b()),style:e.normalizeStyle(e.unref(T))},[e.createElementVNode("div",{class:e.normalizeClass({[e.unref(m).m("fixed")]:l.value}),style:e.normalizeStyle(e.unref(b))},[e.renderSlot(o.$slots,"default")],6)],6))}});exports.default=C;
