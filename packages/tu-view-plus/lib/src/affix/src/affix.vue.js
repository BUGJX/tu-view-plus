"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),f=require("@vueuse/core"),E=require("./affix.js"),d=require("@tu-view-plus/utils"),$=require("@tu-view-plus/hooks");require("../style/affix.css");const C=e.defineComponent({name:"TuAffix"}),B=e.defineComponent({...C,props:E.affixProps,emits:E.affixEmits,setup(_,{expose:y,emit:T}){const t=_,m=T,p=$.useNamespace("affix"),s=e.shallowRef(),c=e.shallowRef(),a=e.shallowRef(),l=e.ref(!1),h=e.ref(0),n=e.ref(0),{height:u}=f.useWindowSize(),{height:r,width:g,top:x,bottom:w,update:v}=f.useElementBounding(c,{windowScroll:!1}),i=f.useElementBounding(s),b=e.computed(()=>({height:l.value?`${r.value}px`:"",width:l.value?`${g.value}px`:""})),q=e.computed(()=>{if(!l.value)return{};const o=t.offset?d.addUnit(t.offset):0;return{height:`${r.value}px`,width:`${g.value}px`,top:t.position==="top"?o:"",bottom:t.position==="bottom"?o:"",transform:n.value?`translateY(${n.value}px)`:"",zIndex:t.zIndex}}),S=()=>{if(a.value)if(h.value=a.value instanceof Window?document.documentElement.scrollTop:a.value.scrollTop||0,t.position==="top")if(t.target){const o=i.bottom.value-t.offset-r.value;l.value=t.offset>x.value&&i.bottom.value>0,n.value=o<0?o:0}else l.value=t.offset>x.value;else if(t.target){const o=u.value-i.top.value-t.offset-r.value;l.value=u.value-t.offset<w.value&&u.value>i.top.value,n.value=o<0?-o:0}else l.value=u.value-t.offset<w.value},z=()=>{v(),m("scroll",{scrollTop:h.value,fixed:l.value})};return e.watch(l,o=>m("change",o)),f.useEventListener(a,"scroll",z),e.watchEffect(S),e.onMounted(()=>{t.target?(s.value=document.querySelector(t.target)??void 0,s.value||d.throwError("TuAffix",`Target is not existed: ${t.target}`)):s.value=document.documentElement,a.value=d.getScrollContainer(c.value,!0),v()}),y({update:S,updateRoot:v}),(o,R)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"root",ref:c,class:e.normalizeClass(e.unref(p).b()),style:e.normalizeStyle(b.value)},[e.createElementVNode("div",{class:e.normalizeClass({[e.unref(p).m("fixed")]:l.value}),style:e.normalizeStyle(q.value)},[e.renderSlot(o.$slots,"default")],6)],6))}});exports.default=B;
