"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("vue"),h=require("./form.js"),O=require("./hooks/use-form-props.js"),b=require("@tu-view-plus/hooks"),j=require("./constants.js"),u=require("./utils.js"),d=require("@tu-view-plus/utils");require("../style/form.css");const S=r.defineComponent({name:"TuForm"}),W=r.defineComponent({...S,props:h.formProps,emits:h.formEmits,setup(v,{expose:g,emit:q}){const o=v,w=q,a=b.useNamespace("form"),y=O.useFormSize(),n=[],_=r.computed(()=>({[a.b()]:!0,[a.m(y.value||"default")]:!0,[a.m(`label-${o.labelPosition}`)]:o.labelPosition,[a.m("inline")]:o.inline})),T=e=>{n.push(e)},E=e=>{e.prop&&n.splice(n.indexOf(e),1)},f=(e=[])=>{if(!o.model){d.debugWarn("TuForm","model is required for resetFields to work.");return}u.filterFields(n,e).forEach(t=>t.resetField())},m=(e=[])=>{u.filterFields(n,e).forEach(t=>t.clearValidate())},P=r.computed(()=>{const e=!!o.model;return e||d.debugWarn("TuForm","model is required for validate to work."),e}),V=e=>{if(n.length===0)return[];const t=u.filterFields(n,e);return t.length?t:(d.debugWarn("TuForm","please pass correct props!"),[])},p=async e=>c(void 0,e),C=async(e=[])=>{if(!P.value)return!1;const t=V(e);if(t.length===0)return!0;let s={};for(const i of t)try{await i.validate("")}catch(l){s={...s,...l}}return Object.keys(s).length===0?!0:Promise.reject(s)},c=async(e=[],t)=>{const s=!d.isFunction(t);try{const i=await C(e);return i===!0&&(t==null||t(i)),i}catch(i){if(i instanceof Error)throw i;const l=i;return o.scrollToError&&F(Object.keys(l)[0]),t==null||t(!1,l),s&&Promise.reject(l)}},F=e=>{var s;const t=u.filterFields(n,e)[0];t&&((s=t.$el)==null||s.scrollIntoView(o.scrollIntoViewOptions))};return r.watch(()=>o.rules,()=>{o.validateOnRuleChange&&p().catch(e=>d.debugWarn(e))},{deep:!0}),r.provide(j.formContextKey,r.reactive({...r.toRefs(o),emit:w,resetFields:f,clearValidate:m,validateField:c,addField:T,removeField:E,...u.useFormLabelWidth()})),g({validate:p,validateField:c,resetFields:f,clearValidate:m,scrollToField:F}),(e,t)=>(r.openBlock(),r.createElementBlock("form",{class:r.normalizeClass(_.value)},[r.renderSlot(e.$slots,"default")],2))}});exports.default=W;
