"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),E=require("./avatar.js"),P=require("./constants.js"),z=require("@tu-view-plus/hooks"),V=require("@tu-view-plus/icons-vue"),c=require("@tu-view-plus/utils");require("../style/avatar.css");const W=["src"],j=e.defineComponent({name:"TuAvatar"}),G=e.defineComponent({...j,props:E.avatarProps,emits:E.avatarEmits,setup(I,{emit:U}){const n=I,g=U,T=e.useSlots(),b=e.useAttrs(),a=z.useNamespace("avatar"),{shape:_,size:s,autoFixFontSize:w,triggerType:S,triggerIconStyle:p}=e.toRefs(n),r=e.inject(P.avatarGroupInjectionKey,void 0),d=e.ref(),u=e.ref(),m=e.ref(!1),v=e.ref(!1),h=e.ref(!0),N=e.ref(!1),x=e.computed(()=>({[a.b()]:!0,[a.m(n.effect)]:n.effect,[a.is("shape")]:_.value=="circle",[a.is("trigger-icon")]:T["trigger-icon"]})),F=e.computed(()=>({[a.e("image")]:m.value||n.imageUrl,[a.e("text")]:!(m.value||n.imageUrl)})),R=e.computed(()=>({[a.e(`trigger-icon-${S.value}`)]:!0,[a.is("shape")]:_.value=="circle"})),y=r?z.useIndex({itemRef:d,selector:`.${z.defaultNamespace}-avatar`}).computedIndex:e.ref(-1),$=e.computed(()=>{const t=c.isNumber(i.value)?{width:c.addUnit(i.value),height:c.addUnit(i.value),fontSize:c.addUnit(i.value/2)}:{};return r&&(t.zIndex=r.zIndexAscend?y.value+1:r.total-y.value,t.marginLeft=y.value!==0?`-${(i.value??40)/4}px`:"0"),t}),B=(({triggerType:t,inlineStyle:l={},triggerIconStyle:o={}})=>{let f={};return t==="button"&&(!o||o&&!o.color)&&l&&l.backgroundColor&&(f={color:l.backgroundColor}),{...o,...f}})({triggerIconStyle:p==null?void 0:p.value,inlineStyle:b.style,triggerType:S.value}),i=e.computed(()=>(r==null?void 0:r.size)??(s==null?void 0:s.value)),k=e.computed(()=>(r==null?void 0:r.autoFixFontSize)??w.value),C=()=>{!m.value&&!n.imageUrl&&e.nextTick(()=>{if(!u.value||!d.value)return;const t=u.value.clientWidth,l=i.value??d.value.offsetWidth,o=l/(t+8);l&&o<1&&(u.value.style.transform=`scale(${o}) translateX(-50%)`),h.value=!0})},q=t=>{g("click",t)},L=()=>{k.value&&C()},A=()=>{N.value=!0,g("load")},M=()=>{v.value=!0,g("error")};return e.watch(s,()=>{k.value&&C()}),e.onMounted(()=>{var t;(t=u.value)!=null&&t.firstElementChild&&["IMG","PICTURE"].includes(u.value.firstElementChild.tagName)&&(m.value=!0),k.value&&C()}),(t,l)=>{const o=e.resolveComponent("tu-icon"),f=e.resolveComponent("tu-resize-observer");return e.openBlock(),e.createElementBlock("div",{ref_key:"itemRef",ref:d,class:e.normalizeClass(x.value),style:e.normalizeStyle($.value),onClick:q},[e.createVNode(f,{onResize:L},{default:e.withCtx(()=>[e.createElementVNode("span",{ref_key:"wrapperRef",ref:u,class:e.normalizeClass(F.value)},[n.imageUrl?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[v.value?e.renderSlot(t.$slots,"error",{key:0},()=>[e.createElementVNode("div",{class:e.normalizeClass(e.unref(a).e("image-icon"))},[e.createVNode(o,null,{default:e.withCtx(()=>[e.createVNode(e.unref(V.PictureRounded))]),_:1})],2)]):e.createCommentVNode("",!0),!(v.value||!h.value)&&!N.value?e.renderSlot(t.$slots,"default",{key:1},()=>[e.createElementVNode("div",{class:e.normalizeClass(e.unref(a).e("image-icon"))},[e.createVNode(o,null,{default:e.withCtx(()=>[e.createVNode(e.unref(V.Loading))]),_:1})],2)]):e.createCommentVNode("",!0),v.value||!h.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("img",{key:2,alt:"avatar",src:n.imageUrl,style:e.normalizeStyle({width:e.unref(c.addUnit)(e.unref(s)),height:e.unref(c.addUnit)(e.unref(s))}),onLoad:A,onError:M},null,44,W))],64)):e.renderSlot(t.$slots,"default",{key:1})],2)]),_:3}),t.$slots["trigger-icon"]?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(R.value),style:e.normalizeStyle(e.unref(B))},[e.renderSlot(t.$slots,"trigger-icon")],6)):e.createCommentVNode("",!0)],6)}}});exports.default=G;
