"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),I=require("./avatar.js"),W=require("./constants.js"),z=require("@tu-view-plus/hooks"),T=require("@tu-view-plus/icons-vue"),c=require("@tu-view-plus/utils"),V=require("../../icon/index.js"),j=require("../../resize-observer/index.js");require("../style/avatar.css");const G=["src"],O=e.defineComponent({name:"TuAvatar"}),H=e.defineComponent({...O,props:I.avatarProps,emits:I.avatarEmits,setup(_,{emit:x}){const o=_,v=x,U=e.useSlots(),$=e.useAttrs(),r=z.useNamespace("avatar"),{shape:C,size:l,autoFixFontSize:R,triggerType:S,triggerIconStyle:g}=e.toRefs(o),a=e.inject(W.avatarGroupInjectionKey,void 0),d=e.ref(),u=e.ref(),m=e.ref(!1),f=e.ref(!1),p=e.ref(!0),N=e.ref(!1),q=e.computed(()=>({[r.b()]:!0,[r.m(o.effect)]:o.effect,[r.is("shape")]:C.value=="circle",[r.is("trigger-icon")]:U["trigger-icon"]})),w=e.computed(()=>({[r.e("image")]:m.value||o.imageUrl,[r.e("text")]:!(m.value||o.imageUrl)})),F=e.computed(()=>({[r.e(`trigger-icon-${S.value}`)]:!0,[r.is("shape")]:C.value=="circle"})),h=a?z.useIndex({itemRef:d,selector:`.${z.defaultNamespace}-avatar`}).computedIndex:e.ref(-1),b=e.computed(()=>{const t=c.isNumber(i.value)?{width:c.addUnit(i.value),height:c.addUnit(i.value),fontSize:c.addUnit(i.value/2)}:{};return a&&(t.zIndex=a.zIndexAscend?h.value+1:a.total-h.value,t.marginLeft=h.value!==0?`-${(i.value??40)/4}px`:"0"),t}),B=(({triggerType:t,inlineStyle:n={},triggerIconStyle:s={}})=>{let E={};return t==="button"&&(!s||s&&!s.color)&&n&&n.backgroundColor&&(E={color:n.backgroundColor}),{...s,...E}})({triggerIconStyle:g==null?void 0:g.value,inlineStyle:$.style,triggerType:S.value}),i=e.computed(()=>(a==null?void 0:a.size)??(l==null?void 0:l.value)),y=e.computed(()=>(a==null?void 0:a.autoFixFontSize)??R.value),k=()=>{!m.value&&!o.imageUrl&&e.nextTick(()=>{if(!u.value||!d.value)return;const t=u.value.clientWidth,n=i.value??d.value.offsetWidth,s=n/(t+8);n&&s<1&&(u.value.style.transform=`scale(${s}) translateX(-50%)`),p.value=!0})},L=t=>{v("click",t)},A=()=>{y.value&&k()},M=()=>{N.value=!0,v("load")},P=()=>{f.value=!0,v("error")};return e.watch(l,()=>{y.value&&k()}),e.onMounted(()=>{var t;(t=u.value)!=null&&t.firstElementChild&&["IMG","PICTURE"].includes(u.value.firstElementChild.tagName)&&(m.value=!0),y.value&&k()}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"itemRef",ref:d,class:e.normalizeClass(q.value),style:e.normalizeStyle(b.value),onClick:L},[e.createVNode(e.unref(j.TuResizeObserver),{onResize:A},{default:e.withCtx(()=>[e.createElementVNode("span",{ref_key:"wrapperRef",ref:u,class:e.normalizeClass(w.value)},[o.imageUrl?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[f.value?e.renderSlot(t.$slots,"error",{key:0},()=>[e.createElementVNode("div",{class:e.normalizeClass(e.unref(r).e("image-icon"))},[e.createVNode(e.unref(V.TuIcon),{size:20},{default:e.withCtx(()=>[e.createVNode(e.unref(T.PictureRounded))]),_:1})],2)]):e.createCommentVNode("",!0),!(f.value||!p.value)&&!N.value?e.renderSlot(t.$slots,"default",{key:1},()=>[e.createElementVNode("div",{class:e.normalizeClass(e.unref(r).e("image-icon"))},[e.createVNode(e.unref(V.TuIcon),{size:20},{default:e.withCtx(()=>[e.createVNode(e.unref(T.Loading))]),_:1})],2)]):e.createCommentVNode("",!0),f.value||!p.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("img",{key:2,alt:"avatar",src:o.imageUrl,style:e.normalizeStyle({width:e.unref(c.addUnit)(e.unref(l)),height:e.unref(c.addUnit)(e.unref(l))}),onLoad:M,onError:P},null,44,G))],64)):e.renderSlot(t.$slots,"default",{key:1})],2)]),_:3}),t.$slots["trigger-icon"]?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(F.value),style:e.normalizeStyle(e.unref(B))},[e.renderSlot(t.$slots,"trigger-icon")],6)):e.createCommentVNode("",!0)],6))}});exports.default=H;
