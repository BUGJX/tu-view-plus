"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),T=require("./drawer.js"),Y=require("../../only-client/index.js"),u=require("@tu-view-plus/hooks"),r=require("@tu-view-plus/utils"),j=require("@tu-view-plus/icons-vue"),S=require("../../button/index.js"),H=require("../../icon/index.js");require("../style/drawer.css");const J=e.defineComponent({name:"TuDrawer",inheritAttrs:!1}),Q=e.defineComponent({...J,props:T.drawerProps,emits:T.drawerEmits,setup(D,{emit:a}){const t=D;let k=0,f=!1;const{t:w}=u.useLocale(),s=u.useNamespace("drawer"),h=u.useNamespace("drawer-container"),{popupContainer:E}=e.toRefs(t),m=e.ref(t.defaultVisible),i=e.ref(!1),n=e.computed(()=>t.visible??m.value),O=e.computed(()=>t.okLoading||i.value),c=e.ref(n.value),{teleportContainer:P,containerRef:p}=u.useTeleportContainer({popupContainer:E,visible:n}),{zIndex:q,isLastDialog:L}=u.usePopupManager("dialog",{visible:n}),{setOverflowHidden:y,resetOverflow:B}=u.useOverflow(p),$=e.computed(()=>(p==null?void 0:p.value)===document.body),K=e.computed(()=>$.value?{zIndex:q.value}:{zIndex:"inherit",position:"absolute"}),M=e.computed(()=>({[s.b()]:!0,[s.m(t.size)]:t.size})),A=e.computed(()=>{const o={[t.placement]:0,...t.drawerStyle};return["right","left"].includes(t.placement)&&(o.width=r.addUnit(t.width)),["top","bottom"].includes(t.placement)&&(o.height=r.addUnit(t.height)),o}),I=o=>{t.maskClosable&&C(o)},C=o=>{let d=!0;r.isFunction(t.onBeforeCancel)&&(d=t.onBeforeCancel()??!1),d&&(a("cancel",o),b())},F=async o=>{const d=k,U=await new Promise(async v=>{if(r.isFunction(t.onBeforeOk)){let l=t.onBeforeOk((V=!0)=>v(V));if((r.isPromise(l)||!r.isBoolean(l))&&(i.value=!0),r.isPromise(l))try{l=await l??!0}catch{l=!1}r.isBoolean(l)&&v(l)}else v(!0)});d===k&&(U?(a("ok",o),b()):i.value&&(i.value=!1))},b=()=>{k++,i.value&&(i.value=!1),m.value=!1,a("update:visible",!1)},G=()=>{n.value&&a("open")},R=()=>{n.value||(c.value=!1,B(),a("close"))},N=()=>{t.escToClose&&!f&&(f=!0,r.on(document.documentElement,"keydown",z))},g=()=>{f&&(f=!1,r.off(document.documentElement,"keydown",z))},z=o=>{t.escToClose&&o.key===r.KEYBOARD_KEY.ESC&&L()&&C(o)};return e.watch(n,o=>{m.value!==o&&(m.value=o),o?(a("beforeOpen"),c.value=!0,y(),N()):(a("beforeClose"),g())}),e.onMounted(()=>{n.value&&(c.value=!0,y(),N())}),e.onBeforeUnmount(()=>{B(),g()}),(o,d)=>(e.openBlock(),e.createBlock(e.unref(Y.TuOnlyClient),null,{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.Teleport,{to:e.unref(P),disabled:!o.renderToBody},[!o.unmountOnClose||e.unref(n)||c.value?e.withDirectives((e.openBlock(),e.createElementBlock("div",e.mergeProps({key:0,class:e.unref(h).b(),style:e.unref(K)},o.$attrs),[e.createVNode(e.Transition,{name:"fade-drawer"},{default:e.withCtx(()=>[o.mask?e.withDirectives((e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(e.unref(h).e("mask")),onClick:I},null,2)),[[e.vShow,e.unref(n)]]):e.createCommentVNode("",!0)]),_:1}),e.createVNode(e.Transition,{name:`slider-drawer-${o.placement}`,appear:"",onAfterEnter:G,onAfterLeave:R},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",{class:e.normalizeClass(e.unref(M)),style:e.normalizeStyle(e.unref(A))},[o.header?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(e.unref(s).e("header"))},[e.renderSlot(o.$slots,"header",{},()=>[o.$slots.title||o.title?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(e.unref(s).e("title"))},[e.renderSlot(o.$slots,"title",{},()=>[e.createTextVNode(e.toDisplayString(o.title),1)])],2)):e.createCommentVNode("",!0),o.closable?(e.openBlock(),e.createElementBlock("div",{key:1,tabindex:"-1",role:"button","aria-label":"Close",class:e.normalizeClass(e.unref(s).e("icon")),onClick:C},[e.createVNode(e.unref(H.TuIcon),null,{default:e.withCtx(()=>[e.createVNode(e.unref(j.Close))]),_:1})],2)):e.createCommentVNode("",!0)])],2)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(e.unref(s).e("body"))},[e.renderSlot(o.$slots,"default")],2),o.footer?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(e.unref(s).e("footer"))},[e.renderSlot(o.$slots,"footer",{},()=>[o.hideCancel?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(e.unref(S.TuButton),e.mergeProps({key:0},o.cancelButtonProps,{size:o.size,onClick:C}),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.cancelText||e.unref(w)("tu.drawer.cancel")),1)]),_:1},16,["size"])),e.createVNode(e.unref(S.TuButton),e.mergeProps({type:"primary"},o.okButtonProps,{size:o.size,loading:e.unref(O),onClick:F}),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.okText||e.unref(w)("tu.drawer.confirm")),1)]),_:1},16,["size","loading"])])],2)):e.createCommentVNode("",!0)],6),[[e.vShow,e.unref(n)]])]),_:3},8,["name"])],16)),[[e.vShow,e.unref(n)||c.value]]):e.createCommentVNode("",!0)],8,["to","disabled"]))]),_:3}))}});exports.default=Q;
