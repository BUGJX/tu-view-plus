"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),T=require("./drawer.js"),j=require("../../only-client/index.js"),u=require("@tu-view-plus/hooks"),l=require("@tu-view-plus/utils"),H=require("@tu-view-plus/icons-vue"),S=require("../../button/index.js"),J=require("../../icon/index.js");require("../style/drawer.css");const Q=e.defineComponent({name:"TuDrawer",inheritAttrs:!1}),W=e.defineComponent({...Q,props:T.drawerProps,emits:T.drawerEmits,setup(D,{emit:E}){let C=0,f=!1;const t=D,a=E,{t:w}=u.useLocale(),s=u.useNamespace("drawer"),h=u.useNamespace("drawer-container"),{popupContainer:O}=e.toRefs(t),m=e.ref(t.defaultVisible),i=e.ref(!1),n=e.computed(()=>t.visible??m.value),P=e.computed(()=>t.okLoading||i.value),c=e.ref(n.value),{teleportContainer:q,containerRef:p}=u.useTeleportContainer({popupContainer:O,visible:n}),{zIndex:L,isLastDialog:$}=u.usePopupManager("dialog",{visible:n}),{setOverflowHidden:y,resetOverflow:B}=u.useOverflow(p),K=e.computed(()=>(p==null?void 0:p.value)===document.body),M=e.computed(()=>K.value?{zIndex:L.value}:{zIndex:"inherit",position:"absolute"}),A=e.computed(()=>({[s.b()]:!0,[s.m(t.size)]:t.size})),I=e.computed(()=>{const o={[t.placement]:0,...t.drawerStyle};return["right","left"].includes(t.placement)&&(o.width=l.addUnit(t.width)),["top","bottom"].includes(t.placement)&&(o.height=l.addUnit(t.height)),o}),F=o=>{t.maskClosable&&v(o)},v=o=>{let d=!0;l.isFunction(t.onBeforeCancel)&&(d=t.onBeforeCancel()??!1),d&&(a("cancel",o),b())},G=async o=>{const d=C,Y=await new Promise(async k=>{if(l.isFunction(t.onBeforeOk)){let r=t.onBeforeOk((V=!0)=>k(V));if((l.isPromise(r)||!l.isBoolean(r))&&(i.value=!0),l.isPromise(r))try{r=await r??!0}catch{r=!1}l.isBoolean(r)&&k(r)}else k(!0)});d===C&&(Y?(a("ok",o),b()):i.value&&(i.value=!1))},b=()=>{C++,i.value&&(i.value=!1),m.value=!1,a("update:visible",!1)},R=()=>{n.value&&a("open")},U=()=>{n.value||(c.value=!1,B(),a("close"))},N=()=>{t.escToClose&&!f&&(f=!0,l.on(document.documentElement,"keydown",z))},g=()=>{f&&(f=!1,l.off(document.documentElement,"keydown",z))},z=o=>{t.escToClose&&o.key===l.KEYBOARD_KEY.ESC&&$()&&v(o)};return e.watch(n,o=>{m.value!==o&&(m.value=o),o?(a("beforeOpen"),c.value=!0,y(),N()):(a("beforeClose"),g())}),e.onMounted(()=>{n.value&&(c.value=!0,y(),N())}),e.onBeforeUnmount(()=>{B(),g()}),(o,d)=>(e.openBlock(),e.createBlock(e.unref(j.TuOnlyClient),null,{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.Teleport,{to:e.unref(q),disabled:!o.renderToBody},[!o.unmountOnClose||n.value||c.value?e.withDirectives((e.openBlock(),e.createElementBlock("div",e.mergeProps({key:0,class:e.unref(h).b(),style:M.value},o.$attrs),[e.createVNode(e.Transition,{name:"fade-drawer"},{default:e.withCtx(()=>[o.mask?e.withDirectives((e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(e.unref(h).e("mask")),onClick:F},null,2)),[[e.vShow,n.value]]):e.createCommentVNode("",!0)]),_:1}),e.createVNode(e.Transition,{name:`slider-drawer-${o.placement}`,appear:"",onAfterEnter:R,onAfterLeave:U},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",{class:e.normalizeClass(A.value),style:e.normalizeStyle(I.value)},[o.header?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(e.unref(s).e("header"))},[e.renderSlot(o.$slots,"header",{},()=>[o.$slots.title||o.title?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(e.unref(s).e("title"))},[e.renderSlot(o.$slots,"title",{},()=>[e.createTextVNode(e.toDisplayString(o.title),1)])],2)):e.createCommentVNode("",!0),o.closable?(e.openBlock(),e.createElementBlock("div",{key:1,tabindex:"-1",role:"button","aria-label":"Close",class:e.normalizeClass(e.unref(s).e("icon")),onClick:v},[e.createVNode(e.unref(J.TuIcon),null,{default:e.withCtx(()=>[e.createVNode(e.unref(H.Close))]),_:1})],2)):e.createCommentVNode("",!0)])],2)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(e.unref(s).e("body"))},[e.renderSlot(o.$slots,"default")],2),o.footer?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(e.unref(s).e("footer"))},[e.renderSlot(o.$slots,"footer",{},()=>[o.hideCancel?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(e.unref(S.TuButton),e.mergeProps({key:0},o.cancelButtonProps,{size:o.size,onClick:v}),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.cancelText||e.unref(w)("tu.drawer.cancel")),1)]),_:1},16,["size"])),e.createVNode(e.unref(S.TuButton),e.mergeProps({type:"primary"},o.okButtonProps,{size:o.size,loading:P.value,onClick:G}),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.okText||e.unref(w)("tu.drawer.confirm")),1)]),_:1},16,["size","loading"])])],2)):e.createCommentVNode("",!0)],6),[[e.vShow,n.value]])]),_:3},8,["name"])],16)),[[e.vShow,n.value||c.value]]):e.createCommentVNode("",!0)],8,["to","disabled"]))]),_:3}))}});exports.default=W;
