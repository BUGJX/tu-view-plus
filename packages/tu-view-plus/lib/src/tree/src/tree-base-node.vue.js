"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),W=require("./tree-base-node.js"),X=require("./tree-node-switcher.vue.js"),Y=require("../../checkbox/index.js"),c=require("../../icon/index.js"),Z=require("./hooks/use-draggable.js"),x=require("./hooks/use-node-key.js"),ee=require("./hooks/use-tree-context.js"),q=require("@tu-view-plus/utils"),ne=require("@tu-view-plus/hooks"),i=require("@tu-view-plus/constants"),oe=require("@tu-view-plus/icons-vue"),ae=["data-level","data-key"],re=["draggable"],le=e.defineComponent({__name:"tree-base-node",props:W.treeBaseNodeProps,setup($){const R=$,r=ne.useNamespace("tree"),l=x.useNodeKey(),o=ee.useTreeContext(),m=e.computed(()=>{var n;return(n=o.key2TreeNode)==null?void 0:n.get(l.value)}),d=e.computed(()=>m.value.treeNodeData),F=e.computed(()=>m.value.children),K=e.computed(()=>{var n;return(n=o==null?void 0:o.treeProps)==null?void 0:n.size}),L=e.computed(()=>{var a;const n=(a=o.treeProps)==null?void 0:a.actionOnNodeClick;return n?q.toArray(n):[]}),{isLeaf:k,isTail:O,selectable:N,disabled:p,disableCheckbox:b,draggable:s}=e.toRefs(R),M=e.computed(()=>{var n;return{[r.e("node")]:!0,[r.is("selected")]:P.value,[r.is("leaf")]:k.value,[r.is("tail")]:O.value,[r.is("expanded")]:g.value,[r.is("disabled-selectable")]:!N.value&&!((n=o.treeProps)!=null&&n.disableSelectActionOnly),[r.is("disabled")]:p.value}}),C=e.ref(),{isDragOver:h,isDragging:D,isAllowDrop:f,dropPosition:y,setDragStatus:v}=Z.useDraggable(e.reactive({key:l,refTitle:C})),A=e.computed(()=>({[r.e("title")]:!0,[r.em("title","draggable")]:s.value,[r.em("title","gap-top")]:h.value&&f.value&&y.value<0,[r.em("title","gap-bottom")]:h.value&&f.value&&y.value>0,[r.em("title","high-light")]:!D.value&&h.value&&f.value&&y.value===0,[r.is("dragging")]:D.value,[r.is("block")]:m.value.blockNode})),T=e.computed(()=>{var n,a;return(a=(n=o.checkedKeys)==null?void 0:n.includes)==null?void 0:a.call(n,l.value)}),w=e.computed(()=>{var n,a;return(a=(n=o.indeterminateKeys)==null?void 0:n.includes)==null?void 0:a.call(n,l.value)}),P=e.computed(()=>{var n,a;return(a=(n=o.selectedKeys)==null?void 0:n.includes)==null?void 0:a.call(n,l.value)}),g=e.computed(()=>{var n,a;return(a=(n=o.expandedKeys)==null?void 0:n.includes)==null?void 0:a.call(n,l.value)}),S=e.computed(()=>{var n,a;return(a=(n=o.loadingKeys)==null?void 0:n.includes)==null?void 0:a.call(n,l.value)}),V=e.computed(()=>o.dragIcon),B=e.computed(()=>o.nodeIcon),t=e.reactive({loading:S,checked:T,selected:P,indeterminate:w,expanded:g,isLeaf:k}),I=e.computed(()=>o.nodeTitle?()=>{var n;return(n=o.nodeTitle)==null?void 0:n.call(o,d.value,t)}:void 0),z=e.computed(()=>o.nodeExtra?()=>{var n;return(n=o.nodeExtra)==null?void 0:n.call(o,d.value,t)}:void 0);function E(n){var a,u;k.value||(!((a=F.value)!=null&&a.length)&&q.isFunction(o.onLoadMore)?o.onLoadMore(l.value):(u=o==null?void 0:o.onExpand)==null||u.call(o,!g.value,l.value,n))}function _(n,a){var u;b.value||p.value||(u=o.onCheck)==null||u.call(o,n,l.value,a)}function j(n){var a;L.value.includes("expand")&&E(n),!(!N.value||p.value)&&((a=o.onSelect)==null||a.call(o,l.value,n))}function G(n){var a;if(s.value){n.stopPropagation(),v("dragStart",n);try{(a=n.dataTransfer)==null||a.setData("text/plain","")}catch{}}}function H(n){s.value&&(n.stopPropagation(),v("dragEnd",n))}function J(n){s&&(n.stopPropagation(),n.preventDefault(),v("dragOver",n))}function Q(n){s.value&&(n.stopPropagation(),v("dragLeave",n))}function U(n){!s.value||!f.value||(n.stopPropagation(),n.preventDefault(),v("drop",n))}return(n,a)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(M.value),"data-level":n.level,"data-key":e.unref(l)},[e.createElementVNode("span",{class:e.normalizeClass(e.unref(r).e("indent"))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.level,u=>(e.openBlock(),e.createElementBlock("span",{key:u,class:e.normalizeClass([e.unref(r).e("indent-block"),e.unref(r).is("lineless",n.lineless[u-1])])},null,2))),128))],2),e.createElementVNode("span",{class:e.normalizeClass([e.unref(r).e("switcher"),e.unref(r).is("expanded",g.value)])},[e.createVNode(X.default,{loading:S.value,"show-line":n.showLine,"tree-node-data":d.value,icons:{switcherIcon:n.switcherIcon,loadingIcon:n.loadingIcon},"node-status":t,onClick:E},e.createSlots({_:2},[n.$slots["switcher-icon"]?{name:"switcher-icon",fn:e.withCtx(()=>[e.createVNode(e.unref(c.TuIcon),null,{default:e.withCtx(()=>[e.renderSlot(n.$slots,"switcher-icon")]),_:3})]),key:"0"}:void 0,n.$slots["loading-icon"]?{name:"loading-icon",fn:e.withCtx(()=>[e.createVNode(e.unref(c.TuIcon),null,{default:e.withCtx(()=>[e.renderSlot(n.$slots,"loading-icon")]),_:3})]),key:"1"}:void 0]),1032,["loading","show-line","tree-node-data","icons","node-status"])],2),n.checkable?(e.openBlock(),e.createBlock(e.unref(Y.TuCheckbox),{key:0,size:K.value,disabled:e.unref(b)||e.unref(p),"model-value":T.value,indeterminate:w.value,onChange:_},null,8,["size","disabled","model-value","indeterminate"])):e.createCommentVNode("",!0),e.createElementVNode("span",{ref_key:"refTitle",ref:C,class:e.normalizeClass(A.value),draggable:e.unref(s),onDragstart:G,onDragend:H,onDragover:J,onDragleave:Q,onDrop:U,onClick:j},[n.$slots.icon||n.icon||B.value?(e.openBlock(),e.createElementBlock("span",{key:0,class:e.normalizeClass(e.unref(r).e("custom-icon"))},[n.$slots.icon?(e.openBlock(),e.createBlock(e.unref(c.TuIcon),{key:0},{default:e.withCtx(()=>[e.renderSlot(n.$slots,"icon",e.normalizeProps(e.guardReactiveProps(t)))]),_:3})):n.icon?(e.openBlock(),e.createBlock(e.unref(c.TuIcon),{key:1},{default:e.withCtx(()=>[e.createVNode(e.unref(i.RenderFunction),e.mergeProps(t,{"render-func":n.icon}),null,16,["render-func"])]),_:1})):B.value?(e.openBlock(),e.createBlock(e.unref(c.TuIcon),{key:2},{default:e.withCtx(()=>[e.createVNode(e.unref(i.RenderFunction),e.mergeProps(t,{"render-func":B.value,node:d.value}),null,16,["render-func","node"])]),_:1})):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0),e.createElementVNode("span",{class:e.normalizeClass(e.unref(r).e("title-text"))},[I.value?(e.openBlock(),e.createBlock(e.unref(i.RenderFunction),{key:0,"render-func":I.value},null,8,["render-func"])):e.renderSlot(n.$slots,"title",{key:1},()=>[e.createTextVNode(e.toDisplayString(n.title),1)]),e.unref(s)?(e.openBlock(),e.createElementBlock("span",{key:2,class:e.normalizeClass(e.unref(r).e("drag-icon"))},[n.$slots["drag-icon"]?e.renderSlot(n.$slots,"drag-icon",e.normalizeProps(e.mergeProps({key:0},t))):n.dragIcon?(e.openBlock(),e.createBlock(e.unref(i.RenderFunction),e.mergeProps({key:1,"render-func":n.dragIcon},t),null,16,["render-func"])):V.value?(e.openBlock(),e.createBlock(e.unref(i.RenderFunction),e.mergeProps({key:2,"render-func":V.value,node:d.value},t),null,16,["render-func","node"])):(e.openBlock(),e.createBlock(e.unref(c.TuIcon),{key:3},{default:e.withCtx(()=>[e.createVNode(e.unref(oe.Rank))]),_:1}))],2)):e.createCommentVNode("",!0)],2)],42,re),z.value?(e.openBlock(),e.createBlock(e.unref(i.RenderFunction),{key:1,"render-func":z.value},null,8,["render-func"])):e.createCommentVNode("",!0)],10,ae))}});exports.default=le;
