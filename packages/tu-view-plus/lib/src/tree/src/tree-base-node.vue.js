"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),X=require("./tree-base-node.js"),Y=require("./tree-node-switcher.vue.js"),Z=require("../../checkbox/index.js"),g=require("../../icon/index.js"),_=require("./hooks/use-draggable.js"),x=require("./hooks/use-node-key.js"),ee=require("./hooks/use-tree-context.js"),q=require("@tu-view-plus/utils"),ne=require("@tu-view-plus/hooks"),u=require("@tu-view-plus/constants"),oe=require("@tu-view-plus/icons-vue"),ae=["data-level","data-key"],re=["draggable"],le=e.defineComponent({__name:"tree-base-node",props:X.treeBaseNodeProps,setup($){const R=$,r=ne.useNamespace("tree"),l=x.useNodeKey(),o=ee.useTreeContext(),m=e.computed(()=>{var n;return(n=o.key2TreeNode)==null?void 0:n.get(l.value)}),i=e.computed(()=>m.value.treeNodeData),F=e.computed(()=>m.value.children),K=e.computed(()=>{var n;return(n=o==null?void 0:o.treeProps)==null?void 0:n.size}),L=e.computed(()=>{var a;const n=(a=o.treeProps)==null?void 0:a.actionOnNodeClick;return n?q.toArray(n):[]}),{isLeaf:k,isTail:O,selectable:N,disabled:v,disableCheckbox:b,draggable:c}=e.toRefs(R),M=e.computed(()=>{var n;return{[r.e("node")]:!0,[r.is("selected")]:w.value,[r.is("leaf")]:k.value,[r.is("tail")]:O.value,[r.is("expanded")]:f.value,[r.is("disabled-selectable")]:!N.value&&!((n=o.treeProps)!=null&&n.disableSelectActionOnly),[r.is("disabled")]:v.value}}),C=e.ref(),{isDragOver:h,isDragging:D,isAllowDrop:p,dropPosition:y,setDragStatus:d}=_.useDraggable(e.reactive({key:l,refTitle:C})),A=e.computed(()=>({[r.e("title")]:!0,[r.em("title","draggable")]:c.value,[r.em("title","gap-top")]:h.value&&p.value&&y.value<0,[r.em("title","gap-bottom")]:h.value&&p.value&&y.value>0,[r.em("title","high-light")]:!D.value&&h.value&&p.value&&y.value===0,[r.is("dragging")]:D.value,[r.is("block")]:m.value.blockNode})),P=e.computed(()=>{var n,a;return(a=(n=o.checkedKeys)==null?void 0:n.includes)==null?void 0:a.call(n,l.value)}),T=e.computed(()=>{var n,a;return(a=(n=o.indeterminateKeys)==null?void 0:n.includes)==null?void 0:a.call(n,l.value)}),w=e.computed(()=>{var n,a;return(a=(n=o.selectedKeys)==null?void 0:n.includes)==null?void 0:a.call(n,l.value)}),f=e.computed(()=>{var n,a;return(a=(n=o.expandedKeys)==null?void 0:n.includes)==null?void 0:a.call(n,l.value)}),S=e.computed(()=>{var n,a;return(a=(n=o.loadingKeys)==null?void 0:n.includes)==null?void 0:a.call(n,l.value)}),V=e.computed(()=>o.dragIcon),B=e.computed(()=>o.nodeIcon),t=e.reactive({loading:S,checked:P,selected:w,indeterminate:T,expanded:f,isLeaf:k}),z=e.computed(()=>o.nodeTitle?()=>{var n;return(n=o.nodeTitle)==null?void 0:n.call(o,i.value,t)}:void 0),E=e.computed(()=>o.nodeExtra?()=>{var n;return(n=o.nodeExtra)==null?void 0:n.call(o,i.value,t)}:void 0);function I(n){var a,s;k.value||(!((a=F.value)!=null&&a.length)&&q.isFunction(o.onLoadMore)?o.onLoadMore(l.value):(s=o==null?void 0:o.onExpand)==null||s.call(o,!f.value,l.value,n))}function j(n,a){var s;b.value||v.value||(s=o.onCheck)==null||s.call(o,n,l.value,a)}function G(n){var a;L.value.includes("expand")&&I(n),!(!N.value||v.value)&&((a=o.onSelect)==null||a.call(o,l.value,n))}function H(n){var a;if(c.value){n.stopPropagation(),d("dragStart",n);try{(a=n.dataTransfer)==null||a.setData("text/plain","")}catch{}}}function J(n){c.value&&(n.stopPropagation(),d("dragEnd",n))}function Q(n){c&&(n.stopPropagation(),n.preventDefault(),d("dragOver",n))}function U(n){c.value&&(n.stopPropagation(),d("dragLeave",n))}function W(n){!c.value||!p.value||(n.stopPropagation(),n.preventDefault(),d("drop",n))}return(n,a)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(M.value),"data-level":n.level,"data-key":e.unref(l)},[e.createElementVNode("span",{class:e.normalizeClass(e.unref(r).e("indent"))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.level,s=>(e.openBlock(),e.createElementBlock("span",{key:s,class:e.normalizeClass([e.unref(r).e("indent-block"),e.unref(r).is("lineless",n.lineless[s-1])])},null,2))),128))],2),e.createElementVNode("span",{class:e.normalizeClass([e.unref(r).e("switcher"),e.unref(r).is("expanded",f.value)])},[e.createVNode(Y.default,{loading:S.value,"show-line":n.showLine,"tree-node-data":i.value,icons:{switcherIcon:n.switcherIcon,loadingIcon:n.loadingIcon},"node-status":t,onClick:I},e.createSlots({_:2},[n.$slots["switcher-icon"]?{name:"switcher-icon",fn:e.withCtx(()=>[e.renderSlot(n.$slots,"switcher-icon")]),key:"0"}:void 0,n.$slots["loading-icon"]?{name:"loading-icon",fn:e.withCtx(()=>[e.renderSlot(n.$slots,"loading-icon")]),key:"1"}:void 0]),1032,["loading","show-line","tree-node-data","icons","node-status"])],2),n.checkable?(e.openBlock(),e.createBlock(e.unref(Z.TuCheckbox),{key:0,size:K.value,disabled:e.unref(b)||e.unref(v),"model-value":P.value,indeterminate:T.value,onChange:j},null,8,["size","disabled","model-value","indeterminate"])):e.createCommentVNode("",!0),e.createElementVNode("span",{ref_key:"refTitle",ref:C,class:e.normalizeClass(A.value),draggable:e.unref(c),onDragstart:H,onDragend:J,onDragover:Q,onDragleave:U,onDrop:W,onClick:G},[n.$slots.icon||n.icon||B.value?(e.openBlock(),e.createElementBlock("span",{key:0,class:e.normalizeClass(e.unref(r).e("custom-icon"))},[n.$slots.icon?(e.openBlock(),e.createBlock(e.unref(g.TuIcon),{key:0},{default:e.withCtx(()=>[e.renderSlot(n.$slots,"icon",e.normalizeProps(e.guardReactiveProps(t)))]),_:3})):n.icon?(e.openBlock(),e.createBlock(e.unref(g.TuIcon),{key:1},{default:e.withCtx(()=>[e.createVNode(e.unref(u.RenderFunction),e.mergeProps(t,{"render-func":n.icon}),null,16,["render-func"])]),_:1})):B.value?(e.openBlock(),e.createBlock(e.unref(g.TuIcon),{key:2},{default:e.withCtx(()=>[e.createVNode(e.unref(u.RenderFunction),e.mergeProps(t,{"render-func":B.value,node:i.value}),null,16,["render-func","node"])]),_:1})):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0),e.createElementVNode("span",{class:e.normalizeClass(e.unref(r).e("title-text"))},[z.value?(e.openBlock(),e.createBlock(e.unref(u.RenderFunction),{key:0,"render-func":z.value},null,8,["render-func"])):e.renderSlot(n.$slots,"title",{key:1},()=>[e.createTextVNode(e.toDisplayString(n.title),1)]),e.unref(c)?(e.openBlock(),e.createElementBlock("span",{key:2,class:e.normalizeClass(e.unref(r).e("drag-icon"))},[n.$slots["drag-icon"]?e.renderSlot(n.$slots,"drag-icon",e.normalizeProps(e.mergeProps({key:0},t))):n.dragIcon?(e.openBlock(),e.createBlock(e.unref(u.RenderFunction),e.mergeProps({key:1,"render-func":n.dragIcon},t),null,16,["render-func"])):V.value?(e.openBlock(),e.createBlock(e.unref(u.RenderFunction),e.mergeProps({key:2,"render-func":V.value,node:i.value},t),null,16,["render-func","node"])):(e.openBlock(),e.createBlock(e.unref(g.TuIcon),{key:3},{default:e.withCtx(()=>[e.createVNode(e.unref(oe.Rank))]),_:1}))],2)):e.createCommentVNode("",!0)],2)],42,re),E.value?(e.openBlock(),e.createBlock(e.unref(u.RenderFunction),{key:1,"render-func":E.value},null,8,["render-func"])):e.createCommentVNode("",!0)],10,ae))}});exports.default=le;
