"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),z=require("./time-picker.js"),h=require("@tu-view-plus/hooks"),r=require("@tu-view-plus/utils"),ue=require("@tu-view-plus/icons-vue");require("../../form/index.js");const se=require("./hooks/use-is-disabled-time.js"),ie=require("./hooks/use-time-format.js"),i=require("./utils.js"),le=require("./hooks/use-time-state.js"),ce=require("../../trigger/index.js"),de=require("../../picker/index.js"),pe=require("../../range-picker/index.js"),fe=require("./time-picker-dropdown.vue.js"),me=require("./time-picker-range-dropdown.vue.js");require("../style/time-picker.css");const ve=require("../../form/src/hooks/use-form-props.js"),ge=t.defineComponent({name:"TuTimePicker",inheritAttrs:!1}),Ve=t.defineComponent({...ge,props:z.timePickerProps,emits:z.TimePickerEmits,setup(A,{emit:E}){const g=A,m=E,{t:P}=h.useLocale(),{type:j,format:x,use12Hours:B,modelValue:M,defaultValue:H,popupVisible:N,defaultPopupVisible:O,placeholder:k,disabledHours:w,disabledMinutes:R,disabledSeconds:F}=t.toRefs(g),U=h.useNamespace("time-picker"),C=ve.useFormDisabled(),[p,T]=h.useState(0),[l,L]=h.useMergeState(O.value,t.reactive({value:N})),V=t.ref(),c=t.computed(()=>j.value==="time-range"),{format:u,use12Hours:G}=ie.useTimeFormat(t.reactive({format:x,use12Hours:B})),{computedValue:_,panelValue:s,inputValue:y,setValue:J,setPanelValue:$,setInputValue:I}=le.useTimeState(t.reactive({modelValue:M,defaultValue:H,isRange:c,format:u})),b=t.shallowReactive({TuPicker:de.TuPicker,TuRangePicker:pe.TuRangePicker,TuTimePickerDropdown:fe.default,TuTimePickerRangeDropdown:me.default}),K=t.computed(()=>{const e=k==null?void 0:k.value;return c.value?r.isUndefined(e)?[P("tu.datepicker.rangePlaceholder.timeStart"),P("tu.datepicker.rangePlaceholder.timeEnd")]:r.isArray(e)?e:[e,e]:r.isUndefined(e)?P("tu.datepicker.placeholder.time"):e}),D=se.useIsDisabledTime(t.reactive({disabledHours:w,disabledMinutes:R,disabledSeconds:F})),Q=t.computed(()=>c.value?{focusedIndex:p.value,onFocusedIndexChange:e=>{T(e)},onChange:Z,onPressEnter:ee}:{onChange:te,onPressEnter:ne}),W=t.computed(()=>c.value?{displayIndex:p.value,onDisplayIndexChange:e=>{T(e),S(e)}}:{}),X=e=>{if(r.isValueChange(e,_.value)){const o=i.getFormattedValue(e,u.value),n=r.getDateValue(e);m("update:modelValue",o),m("change",o,n)}},d=(e,o)=>{if(D(e))return;let n=e;if(r.isArray(e)){const f=r.dayjs();n=e.map(a=>(a&&(a=a.year(f.year()),a=a.month(f.month()),a=a.date(f.date())),a)),i.isValidRangeValue(n)&&(n=r.getSortedDayjsArray(n)),(n==null?void 0:n.length)===0&&(n=void 0)}X(n),J(n),o!==l.value&&v(o)},q=(e,o)=>{$(e),o!==l.value&&v(o)},v=e=>{e!==l.value&&(L(e),m("popup-visible-change",e),m("update:popupVisible",e))},S=e=>{V.value&&V.value.focus&&V.value.focus(e)},Y=e=>{C.value||(v(e),e&&t.nextTick(()=>{S(p.value)}))},Z=e=>{v(!0);const o=e.target.value,n=r.isArray(y.value)?[...y.value]:r.isArray(s.value)&&i.getFormattedValue(s.value,u.value)||[];if(n[p.value]=o,I(n),!i.isValidInputValue(o,u.value))return;const f=r.dayjs(o,u.value);if(D(f))return;const a=r.isArray(s.value)?[...s.value]:[];a[p.value]=f,g.disableConfirm&&i.isValidRangeValue(a)?d(a,!0):q(a,!0)},ee=()=>{if(i.isValidRangeValue(s.value))d(s.value,!1);else{const e=(p.value+1)%2;T(e),S(e)}},te=e=>{v(!0);const o=e.target.value;if(I(o),!i.isValidInputValue(o,u.value))return;const n=r.dayjs(o,u.value);D(n)||(g.disableConfirm?d(n,!0):q(n,!0))},ne=()=>{d(s.value||_.value,!1)},oe=e=>{e.stopPropagation(),$(void 0),d(void 0,!1)},re=e=>{const o=i.getFormattedValue(e,u.value),n=r.getDateValue(e);m("select",o,n),g.disableConfirm&&(!c.value||i.isValidRangeValue(e))?d(e,!0):(q(e,!0),I(void 0))},ae=e=>{d(e,!1)};return(e,o)=>(t.openBlock(),t.createBlock(t.unref(ce.TuTrigger),{trigger:"click","animation-name":"slide-dynamic-origin","auto-fit-transform-origin":"","click-to-close":!1,position:e.position,disabled:t.unref(C)||e.readonly,"popup-offset":8,"popup-visible":t.unref(l),"prevent-focus":!0,"unmount-on-close":e.unmountOnClose,"popup-container":e.popupContainer,onPopupVisibleChange:Y},{content:t.withCtx(()=>[t.createElementVNode("div",{class:t.normalizeClass(t.unref(U).e("container"))},[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(c.value?t.unref(b).TuTimePickerRangeDropdown:t.unref(b).TuTimePickerDropdown),t.mergeProps(W.value,{size:e.size,value:t.unref(s),visible:t.unref(l),format:t.unref(u),"use12-hours":t.unref(G),step:e.step,"disabled-hours":t.unref(w),"disabled-minutes":t.unref(R),"disabled-seconds":t.unref(F),"hide-disabled-options":e.hideDisabledOptions,"hide-footer":e.disableConfirm,onSelect:re,onConfirm:ae}),t.createSlots({_:2},[e.$slots.extra?{name:"extra-footer",fn:t.withCtx(()=>[t.renderSlot(e.$slots,"extra")]),key:"0"}:void 0]),1040,["size","value","visible","format","use12-hours","step","disabled-hours","disabled-minutes","disabled-seconds","hide-disabled-options","hide-footer"]))],2)]),default:t.withCtx(()=>[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(c.value?t.unref(b).TuRangePicker:t.unref(b).TuPicker),t.mergeProps({ref_key:"refInput",ref:V},{...e.$attrs,...Q.value},{"input-value":t.unref(y),value:t.unref(s),size:e.size,focused:t.unref(l),format:t.unref(u),visible:t.unref(l),disabled:t.unref(C),editable:!e.readonly,"allow-clear":e.allowClear&&!e.readonly,placeholder:K.value,onClear:t.withModifiers(oe,["stop"])}),t.createSlots({"suffix-icon":t.withCtx(()=>[t.renderSlot(e.$slots,"suffix-icon",{},()=>[t.createVNode(t.unref(ue.Clock))])]),_:2},[e.$slots.prefix?{name:"prefix",fn:t.withCtx(()=>[t.renderSlot(e.$slots,"prefix")]),key:"0"}:void 0]),1040,["input-value","value","size","focused","format","visible","disabled","editable","allow-clear","placeholder"]))]),_:3},8,["position","disabled","popup-visible","unmount-on-close","popup-container"]))}});exports.default=Ve;
