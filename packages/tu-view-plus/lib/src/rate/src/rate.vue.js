"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),K=require("@tu-view-plus/hooks"),d=require("@tu-view-plus/constants"),i=require("@tu-view-plus/utils");require("../../form/index.js");const I=require("../../icon/index.js"),g=require("./rate.js");require("../style/rate.css");const W=require("../../form/src/constants.js"),S=require("../../form/src/hooks/use-form-props.js"),U=require("../../form/src/hooks/use-form-item.js"),X=["id","aria-label","aria-labelledby","aria-valuenow","aria-valuetext","aria-valuemax"],G=["onMousemove","onClick"],J=e.defineComponent({name:"TuRate"}),Q=e.defineComponent({...J,props:g.rateProps,emits:g.rateEmits,setup(M,{expose:N,emit:q}){const o=M,v=q,n=K.useNamespace("rate"),C=e.inject(W.formItemContextKey,void 0),O=S.useFormSize(),u=S.useFormDisabled(),{inputId:z,isLabeledByFormItem:w}=U.useFormItemInputId(o,{formItemContext:C}),r=e.ref(o.modelValue),h=e.ref(-1),m=e.ref(!0),F=e.computed(()=>({[n.b()]:!0,[n.m(O.value)]:!0,[n.is("disabled")]:u.value})),H=e.computed(()=>{const l={};return l["--rate-void-color"]=o.voidColor,l["--rate-disabled-void-color"]=o.disabledVoidColor,l["--rate-fill-color"]=b.value,l}),V=(l,a)=>{const t=s=>i.isObject(s),c=Object.keys(a).map(s=>+s).filter(s=>{const p=a[s];return(t(p)?p.excluded:!1)?l<s:l<=s}).sort((s,p)=>s-p),f=a[c[0]];return t(f)&&f.value||f},E=e.computed(()=>{let l="";return o.showScore?l=o.scoreTemplate.replace(/\{\s*value\s*\}/,u.value?`${o.modelValue}`:`${r.value}`):o.showText&&(l=o.texts[Math.ceil(r.value)-1]),l}),y=e.computed(()=>o.modelValue*100-Math.floor(o.modelValue)*100),A=e.computed(()=>i.isArray(o.colors)?{[o.lowThreshold]:o.colors[0],[o.highThreshold]:{value:o.colors[1],excluded:!0},[o.max]:o.colors[2]}:o.colors),b=e.computed(()=>{const l=V(r.value,A.value);return i.isObject(l)?"":l}),P=e.computed(()=>{let l="";return u.value?l=`${y.value}%`:o.allowHalf&&(l="50%"),{color:b.value,width:l}}),k=e.computed(()=>{let l=i.isArray(o.icons)?[...o.icons]:{...o.icons};return l=e.markRaw(l),i.isArray(l)?{[o.lowThreshold]:l[0],[o.highThreshold]:{value:l[1],excluded:!0},[o.max]:l[2]}:l}),R=e.computed(()=>V(o.modelValue,k.value)),x=e.computed(()=>u.value?i.isString(o.disabledVoidIcon)?o.disabledVoidIcon:e.markRaw(o.disabledVoidIcon):i.isString(o.voidIcon)?o.voidIcon:e.markRaw(o.voidIcon)),j=e.computed(()=>V(r.value,k.value)),D=l=>{const a=u.value&&y.value>0&&l-1<o.modelValue&&l>o.modelValue,t=o.allowHalf&&m.value&&l-.5<=r.value&&l>r.value;return a||t},B=l=>{o.clearable&&l===o.modelValue&&(l=0),v(d.UPDATE_MODEL_EVENT,l),o.modelValue!==l&&v("change",l)},L=l=>{u.value||(o.allowHalf&&m.value?B(r.value):B(l))},$=l=>{if(u.value)return;let a=r.value;const t=l.code;return t===d.EVENT_CODE.up||t===d.EVENT_CODE.right?(o.allowHalf?a+=.5:a+=1,l.stopPropagation(),l.preventDefault()):(t===d.EVENT_CODE.left||t===d.EVENT_CODE.down)&&(o.allowHalf?a-=.5:a-=1,l.stopPropagation(),l.preventDefault()),a=a<0?0:a,a=a>o.max?o.max:a,v(d.UPDATE_MODEL_EVENT,a),v("change",a),a},T=(l,a)=>{if(!u.value){if(o.allowHalf&&a){let t=a.target;i.hasClass(t,n.e("item"))&&(t=t.querySelector(`.${n.e("icon")}`)),(t.clientWidth===0||i.hasClass(t,n.e("decimal")))&&(t=t.parentNode),m.value=a.offsetX*2<=t.clientWidth,r.value=m.value?l-.5:l}else r.value=l;h.value=l}},_=()=>{u.value||(o.allowHalf&&(m.value=o.modelValue!==Math.floor(o.modelValue)),r.value=o.modelValue,h.value=-1)};return e.watch(()=>o.modelValue,l=>{r.value=l,m.value=o.modelValue!==Math.floor(o.modelValue)}),o.modelValue||v(d.UPDATE_MODEL_EVENT,0),N({handleSetCurrentValue:T,handleResetCurrentValue:_}),(l,a)=>{var t;return e.openBlock(),e.createElementBlock("div",{role:"slider",id:e.unref(z),class:e.normalizeClass(F.value),"aria-label":e.unref(w)?void 0:l.label||"rating","aria-labelledby":e.unref(w)?(t=e.unref(C))==null?void 0:t.labelId:void 0,"aria-valuenow":r.value,"aria-valuetext":E.value||void 0,"aria-valuemin":"0","aria-valuemax":l.max,tabindex:"0",style:e.normalizeStyle(H.value),onKeydown:$},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.max,(c,f)=>(e.openBlock(),e.createElementBlock("span",{key:f,class:e.normalizeClass(e.unref(n).e("item")),onMousemove:s=>T(c,s),onMouseleave:_,onClick:s=>L(c)},[e.createVNode(e.unref(I.TuIcon),{class:e.normalizeClass([e.unref(n).e("icon"),{hover:h.value===c},e.unref(n).is("active",c<=r.value)])},{default:e.withCtx(()=>[D(c)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.withDirectives((e.openBlock(),e.createBlock(e.resolveDynamicComponent(j.value),null,null,512)),[[e.vShow,c<=r.value]]),e.withDirectives((e.openBlock(),e.createBlock(e.resolveDynamicComponent(x.value),null,null,512)),[[e.vShow,!(c<=r.value)]])],64)),D(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(x.value),{class:e.normalizeClass([e.unref(n).em("decimal","box")])},null,8,["class"])),e.createVNode(e.unref(I.TuIcon),{style:e.normalizeStyle(P.value),class:e.normalizeClass([e.unref(n).e("icon"),e.unref(n).e("decimal")])},{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(R.value)))]),_:1},8,["style","class"])],64)):e.createCommentVNode("",!0)]),_:2},1032,["class"])],42,G))),128)),l.showText||l.showScore?(e.openBlock(),e.createElementBlock("span",{key:0,class:e.normalizeClass(e.unref(n).e("text")),style:e.normalizeStyle({color:l.textColor})},e.toDisplayString(E.value),7)):e.createCommentVNode("",!0)],46,X)}}});exports.default=Q;
